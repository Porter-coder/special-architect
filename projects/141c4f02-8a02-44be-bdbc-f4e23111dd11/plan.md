# 实现计划

## 用户需求
帮我写一个计算BMI的计算器

## 详细计划
# BMI计算器技术实现计划

## 一、总体架构与设计模式

### 1.1 整体架构概述

本项目采用分层架构设计，将应用程序划分为表现层、业务逻辑层、数据访问层和数据存储层四个主要层次。这种分层架构的优势在于实现了关注点分离，使得各层之间的耦合度降低，便于独立开发、测试和维护。表现层负责用户界面的呈现和交互处理，业务逻辑层承载核心计算逻辑和业务规则，数据访问层封装所有与数据库操作相关的方法，数据存储层则通过SQLite数据库实现持久化存储。

整体架构遵循MVC（Model-View-Controller）设计模式的变体，将数据模型、用户界面和控制逻辑明确分离。模型层定义BMI记录和用户配置的数据结构，视图层处理所有用户界面的渲染和更新，控制器层作为中间协调者，接收用户输入、调用业务逻辑并更新视图显示。这种设计模式能够有效支持后续的功能扩展和界面重构，同时保持核心业务逻辑的稳定性。

### 1.2 技术选型策略

考虑到跨平台兼容性、性能要求和开发效率的综合需求，本项目选择Python作为主要开发语言。Python在数据处理、科学计算和GUI开发领域拥有丰富的生态系统，能够很好地满足BMI计算器的功能需求。GUI框架选用CustomTkinter作为主要界面库，该库基于Tkinter构建但提供了现代化的深色模式支持和更美观UI组件，能够自动适配操作系统的主题设置。数据存储选用SQLite嵌入式数据库，无需额外的数据库服务器，部署简单且性能可靠。数据可视化功能通过Matplotlib库实现，该库提供丰富的图表类型和定制选项，能够生成符合设计要求的BMI趋势曲线图。

### 1.3 模块化设计原则

应用程序采用插件化模块设计思想，核心功能模块包括输入处理模块、BMI计算模块、健康分类模块、数据存储模块、历史管理模块和图表渲染模块。各模块之间通过明确定义的接口进行通信，模块内部实现细节对外部不可见。这种设计使得各功能模块可以独立开发和测试，也便于后续的功能扩展和代码维护。例如，未来如需增加BMI预测功能或对接外部健康设备，只需实现相应的接口并集成到现有框架中即可，无需重构整个应用程序。

## 二、核心组件及其职责

### 2.1 输入处理组件

输入处理组件负责接收和验证用户的所有输入数据，是数据进入系统的第一道关口。该组件包含单位转换器、格式验证器和范围检查器三个子组件。单位转换器负责将用户输入的英制单位数据转换为内部使用的公制单位，支持公斤/米和公斤/厘米两种公制输入方式，以及磅/英尺+英寸的复合英制输入方式。格式验证器使用正则表达式对输入字符串进行模式匹配，能够识别不同地区的数字格式，包括使用逗号作为小数分隔符的欧洲格式和允许千位分隔符的多种输入变体。范围检查器根据预定义的有效值区间对输入数据进行校验，身高有效范围为50厘米至300厘米，体重有效范围为10公斤至500公斤，超出范围的数据将被标记为无效并返回相应的错误提示。

输入组件还需处理键盘快捷键和焦点管理，支持Tab键在输入框间切换、Enter键触发表单提交等标准交互模式。组件提供增量验证机制，在用户输入过程中实时反馈数据合法性状态，避免用户完成输入后才看到错误提示。对于复合输入场景（如英尺+英寸），组件需要协调两个输入框的验证逻辑，确保在两个字段都填写有效后才允许进行计算操作。

### 2.2 BMI计算引擎

BMI计算引擎是应用程序的核心组件，负责执行精确的BMI数值计算。该引擎采用工厂模式设计，支持根据不同分类标准进行计算和判定。引擎接收经过验证的身高和体重数据，首先执行单位标准化处理，将所有输入转换为以米为身高单位和以公斤为体重单位的内部标准格式，然后按照公式BMI = 体重(kg) / 身高(m)²进行计算。

计算过程采用IEEE 754双精度浮点数运算，确保计算结果的精度满足要求。计算完成后，引擎将结果四舍五入至一位小数，并执行健康分类判定。分类判定采用可配置的分类标准集，默认使用WHO国际标准，同时提供亚洲标准作为可选配置。引擎输出包含BMI数值、分类代码、分类名称和详细说明的结构化结果对象，供后续的界面显示和数据存储使用。

### 2.3 健康分类判定器

健康分类判定器实现了多标准的分类算法，能够根据用户选择的分类体系对BMI值进行准确归类。判定器内部维护不同分类标准的阈值配置，WHO标准的分类区间为：体重过轻（BMI < 18.5）、正常范围（18.5 ≤ BMI < 25）、超重（25 ≤ BMI < 30）、肥胖（BMI ≥ 30）。亚洲标准的分类区间有所调整，需根据具体规范实现。

判定算法采用多条件分支结构，按照从特殊到一般的顺序进行条件判断。对于边界值处理，判定器遵循"左闭右开"原则，即当BMI值正好等于阈值时归入较高类别。判定结果不仅包含分类代码，还附带相应的健康建议文本，帮助用户理解自己的体重状态并采取适当的健康管理措施。判定器支持扩展接口，便于未来添加其他分类标准或针对特定人群的定制规则。

### 2.4 数据持久化层

数据持久化层封装所有与SQLite数据库交互的操作，向上层提供统一的数据访问接口。该层包含记录管理器和配置管理器两个主要组件。记录管理器负责BMI计算历史记录的增删改查操作，每条记录包含唯一标识符、时间戳、身高、体重、BMI值、单位体系、分类标准等完整信息。配置管理器负责存储和检索用户偏好设置，包括默认单位体系、默认分类标准、界面主题和语言设置等。

数据库设计采用规范化的表结构，主表存储BMI记录，辅表存储用户配置和分类标准定义。为优化查询性能，在时间戳字段上建立索引，支持高效的时间范围查询。数据库操作采用事务机制，确保写入操作的原子性，避免因程序异常中断导致数据损坏。持久化层还提供数据导出功能，支持将历史记录导出为CSV格式，便于用户在其他工具中进行进一步分析。

### 2.5 历史记录管理组件

历史记录管理组件为用户提供历史数据的浏览、检索和管理功能。该组件与数据持久化层紧密协作，实现历史记录的加载、显示和过滤。组件支持按时间排序的历史记录展示，默认采用时间倒序排列，最新的计算结果置于列表顶部。组件实现分页加载机制，当历史记录数量超过预设阈值时，仅加载当前页面的数据进行显示，避免大量数据导致的性能问题。

组件提供多种数据筛选方式，用户可以按时间范围（近一周、近一月、近三月、全部）筛选历史记录，也可以通过搜索功能快速定位特定记录。管理功能包括删除单条记录、批量删除选定记录和清空全部历史三个操作级别，每种删除操作都配备确认对话框，防止误操作导致数据丢失。组件还支持历史记录的撤销功能，在用户执行删除操作后的一段时间内提供撤销入口。

### 2.6 数据可视化组件

数据可视化组件负责将历史BMI数据以图表形式呈现给用户，帮助用户直观了解体重变化趋势。该组件封装Matplotlib的图表渲染能力，生成包含时间轴和BMI值曲线的趋势图。图表采用日期作为X轴，BMI值作为Y轴，不同的健康分类区间用不同的背景颜色标识，使用户一眼即可看出自己的BMI值处于哪个
