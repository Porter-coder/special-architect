# 实现计划

## 用户需求
一个猜数字游戏，1-100之间随机生成数字，用户输入猜测，程序提示太大或太小，猜对后显示用了几次

## 详细计划
# PHASE 2: 技术规划文档

## 猜数字游戏技术实现计划

---

## 一、总体架构与设计模式

### 1.1 架构概述

本项目采用**分层架构模式**设计，将用户界面、业务逻辑和数据处理三个关注点进行清晰分离。这种架构确保了代码的可维护性、可扩展性和可测试性，同时保持了单文件分发的便捷性。

```
┌─────────────────────────────────────────────────────────────┐
│                      表示层 (Presentation Layer)            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │
│  │   CLIRenderer   │  │   ColorOutput   │  │  InputForm  │  │
│  └─────────────────┘  └─────────────────┘  └─────────────┘  │
├─────────────────────────────────────────────────────────────┤
│                      应用层 (Application Layer)             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              NumberGuessingGame (游戏控制器)         │   │
│  │  ┌───────────┐  ┌───────────┐  ┌─────────────────┐  │   │
│  │  │ GameState │  │ GameLogic │  │ ScoreManager    │  │   │
│  │  └───────────┘  └───────────┘  └─────────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│                      基础设施层 (Infrastructure Layer)      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │
│  │   RandomGenerator│ │   InputValidator│ │  ScreenUtils │  │
│  └─────────────────┘  └─────────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 设计模式应用

**策略模式 (Strategy Pattern)**：用于处理不同的输入验证策略和结果显示策略。这种设计允许在未来轻松扩展新的验证规则或输出格式，而无需修改核心游戏逻辑。

**状态模式 (State Pattern)**：游戏状态管理采用状态模式实现，明确区分游戏进行中、游戏胜利、游戏退出等状态，确保状态转换的清晰可控。

**单例模式 (Singleton Pattern)**：游戏配置和全局设置采用单例模式，保证整个应用中配置的一致性。

**工厂模式 (Factory Pattern)**：用于创建不同类型的输入验证器，提高代码的模块化程度。

---

## 二、关键组件及其职责

### 2.1 表示层组件

#### 2.1.1 CLIRenderer（命令行渲染器）

**职责描述**：负责所有终端界面的渲染工作，包括欢迎横幅、游戏进行中的状态显示、结果画面和菜单界面。该组件封装了所有与用户视觉交互相关的逻辑。

**核心方法**：
- `render_welcome()`：渲染游戏启动画面，包含游戏标题、版本信息和操作提示
- `render_game_status(guess_count, hint)`：渲染当前游戏状态，显示猜测次数和提示信息
- `render_win_screen(guess_count, best_score)`：渲染胜利画面，展示本次成绩和历史最佳记录
- `render_menu(options)`：渲染可交互菜单，支持键盘选择
- `render_error(message)`：渲染错误提示，以醒目方式显示错误信息

**设计考量**：所有渲染方法都应支持禁用颜色输出的功能，以便在不支持ANSI颜色的终端中正常运行。

#### 2.1.2 ColorOutput（色彩输出管理器）

**职责描述**：封装所有与终端颜色相关的操作，提供统一的颜色接口，支持颜色的启用和禁用控制。

**核心方法**：
- `get_color(color_code)`：根据颜色代码返回对应的ANSI转义序列
- `print_colored(text, color)`：打印彩色文本
- `disable_colors()`：全局禁用颜色输出
- `enable_colors()`：全局启用颜色输出

**颜色定义**：
- SUCCESS（绿色）：用于成功提示和正确答案
- WARNING（黄色）：用于警告和提示信息
- ERROR（红色）：用于错误消息
- INFO（蓝色）：用于一般信息显示
- HIGHLIGHT（青色/加粗）：用于重要信息和用户输入提示

#### 2.1.3 InputForm（输入表单处理器）

**职责描述**：处理所有用户输入的获取和预处理工作，提供流畅的输入体验。

**核心方法**：
- `get_number(prompt, min_val, max_val)`：获取指定范围内的数字输入
- `get_choice(prompt, options)`：获取用户选择的菜单项
- `get_text(prompt)`：获取一般文本输入
- `handle_interrupt()`：处理用户Ctrl+C中断

**设计考量**：该组件需要处理各种边缘情况，包括空输入、特殊字符输入、Ctrl+C中断等，确保程序不会因异常输入而崩溃。

### 2.2 应用层组件

#### 2.2.1 NumberGuessingGame（游戏控制器）

**职责描述**：作为游戏的核心控制器，协调所有其他组件的工作，管理游戏生命周期。

**属性定义**：
- `target_number: int`：目标数字，1-100之间的随机整数
- `guess_count: int`：当前猜测次数
- `game_over: bool`：游戏结束标志
- `best_score: int`：历史最佳记录（最少猜测次数）
- `is_running: bool`：游戏运行状态

**核心方法**：
- `start()`：启动游戏，初始化所有组件
- `play()`：主游戏循环，处理游戏逻辑
- `reset()`：重置游戏状态，准备新一轮游戏
- `quit()`：优雅退出游戏，释放资源
- `show_menu()`：显示主菜单并处理用户选择

**状态转换**：
```
开始 → 主菜单 → 游戏进行中 → (胜利/退出) → 主菜单/结束
```

#### 2.2.2 GameState（游戏状态管理）

**职责描述**：管理游戏的当前状态和历史数据，提供状态查询和持久化接口。

**状态定义**：
- `MENU`：主菜单状态
- `PLAYING`：游戏进行中状态
- `WON`：游戏胜利状态
- `LOST`：游戏失败状态（预留扩展）
- `EXITING`：退出中状态

**核心方法**：
- `get_state()`：获取当前状态
- `set_state(new_state)`：设置新状态
- `save_score(score)`：保存分数到历史记录
- `get_best_score()`：获取历史最佳分数

#### 2.2.3 GameLogic（游戏逻辑处理器）

**职责描述**：封装所有游戏规则和判断逻辑，与用户界面逻辑解耦。

**核心方法**：
- `generate_target(min_val, max_val)`：生成指定范围内的随机目标数字
- `compare(guess, target)`：比较猜测值与目标值，返回比较结果
- `is_valid_guess(guess, min_val, max_val)`：验证猜测值是否在合法范围内
- `calculate_hint(guess, target)`：根据猜测值生成提示信息

**比较结果定义**：
- `LESS`：猜测值小于目标值
- `GREATER`：猜测值大于目标值
- `EQUAL`：猜测值等于目标值

#### 2.2.4 ScoreManager（分数管理器）

**职责描述**：管理玩家分数记录，包括当前游戏分数和历史最佳分数。

**核心方法**：
- `update_best_score(current_score)`：更新历史最佳记录
- `get_best_score()`：获取历史最佳分数
- `reset_scores()`：重置所有分数记录
- `load_scores()`：从文件加载历史记录（预留持久化功能）

### 2.3 基础设施层组件

#### 2.3.1 RandomGenerator（随机数生成器）

**职责描述**：提供高质量的随机数生成功能，封装random模块的复杂性。

**核心方法**：
- `generate_int(min_val, max_val)`：生成指定范围内的随机整数
- `generate_with_seed(min_val, max_val, seed)`：使用指定种子生成随机数（用于测试）

**设计考量**：该组件允许在测试环境中使用固定种子，确保测试结果的可重复性。

#### 2.3.2 Input
