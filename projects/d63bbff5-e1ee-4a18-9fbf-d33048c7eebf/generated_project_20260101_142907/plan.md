# å®ç°è®¡åˆ’ (AI ç”Ÿæˆ)

**ç”Ÿæˆæ—¶é—´**: 2026-01-01 14:29:07 UTC
**åŸå§‹éœ€æ±‚**: å¸®æˆ‘å†™ä¸€ä¸ªç®€å•çš„è·å–å½“ä¸‹ç³»ç»Ÿæ—¶é—´çš„è½¯ä»¶ï¼Œè‡ªåŠ¨åˆ¤æ–­æˆ‘æ˜¯ä¸æ˜¯åº”è¯¥ç¡è§‰äº†

## é¡¹ç›®ç›®æ ‡

å®ç°ç”¨æˆ·éœ€æ±‚ï¼šå¸®æˆ‘å†™ä¸€ä¸ªç®€å•çš„è·å–å½“ä¸‹ç³»ç»Ÿæ—¶é—´çš„è½¯ä»¶ï¼Œè‡ªåŠ¨åˆ¤æ–­æˆ‘æ˜¯ä¸æ˜¯åº”è¯¥ç¡è§‰äº†

## æŠ€æœ¯æ–¹æ¡ˆ

### ç¬¬ä¸€é˜¶æ®µï¼šéœ€æ±‚åˆ†æ
<think>
ç”¨æˆ·æƒ³è¦ä¸€ä¸ªç®€å•çš„è·å–å½“å‰ç³»ç»Ÿæ—¶é—´çš„è½¯ä»¶ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦åº”è¯¥ç¡è§‰äº†ã€‚

æˆ‘éœ€è¦å…ˆè¿›è¡Œéœ€æ±‚åˆ†æï¼Œç„¶åæä¾›è¯¦ç»†çš„æŠ€æœ¯è§„èŒƒã€‚è®©æˆ‘æ€è€ƒä¸€ä¸‹è¿™ä¸ªè½¯ä»¶åº”è¯¥åŒ…å«ä»€ä¹ˆåŠŸèƒ½ï¼š

æ ¸å¿ƒåŠŸèƒ½ï¼š
1. è·å–å½“å‰ç³»ç»Ÿæ—¶é—´
2. åˆ¤æ–­æ˜¯å¦åº”è¯¥ç¡è§‰äº†ï¼ˆéœ€è¦å®šä¹‰ç¡çœ æ—¶é—´èŒƒå›´ï¼‰
3. æ˜¾ç¤ºå‹å¥½çš„ç•Œé¢

æŠ€æœ¯æ–¹é¢ï¼š
- Pythonæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒç®€å•ä¸”è·¨å¹³å°
- å¯ä»¥ä½¿ç”¨TkinteråšGUIï¼Œæˆ–è€…å‘½ä»¤è¡Œæ–¹å¼
- éœ€è¦è€ƒè™‘ç¡çœ æ—¶é—´çš„é…ç½®ï¼ˆå›ºå®šæ—¶é—´è¿˜æ˜¯å¯é…ç½®çš„ï¼‰

è®©æˆ‘è¯¦ç»†åˆ†æå¹¶æ’°å†™æŠ€æœ¯è§„èŒƒã€‚
</think>

# Python ç¡çœ æé†’æ—¶é’Ÿ - æŠ€æœ¯è§„æ ¼æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç³»ç»Ÿæ—¶é’Ÿåº”ç”¨ï¼Œä¸ä»…å®æ—¶æ˜¾ç¤ºå½“å‰æ—¶é—´ï¼Œè¿˜èƒ½æ ¹æ®ç”¨æˆ·è®¾å®šçš„ç¡çœ ä½œæ¯æ—¶é—´ï¼Œè‡ªåŠ¨åˆ¤æ–­å¹¶æé†’ç”¨æˆ·æ˜¯å¦åº”è¯¥ä¼‘æ¯ã€‚è½¯ä»¶é‡‡ç”¨Pythonå¼€å‘ï¼Œéµå¾ªç®€æ´è®¾è®¡åŸåˆ™ï¼Œé€‚åˆæ—¥å¸¸ä½¿ç”¨åœºæ™¯ã€‚

---

## 2. æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§

### 2.1 ä¸»è¦åŠŸèƒ½æ¨¡å—

**å®æ—¶æ—¶é’Ÿæ˜¾ç¤º**
- è·å–å¹¶å±•ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç²¾ç¡®åˆ°ç§’
- æ”¯æŒ12å°æ—¶åˆ¶å’Œ24å°æ—¶åˆ¶æ ¼å¼åˆ‡æ¢
- åŒæ—¶æ˜¾ç¤ºæ—¥æœŸã€æ˜ŸæœŸå‡ 
- è‡ªåŠ¨å¤„ç†æ—¶åŒºé—®é¢˜ï¼Œä½¿ç”¨ç³»ç»Ÿæœ¬åœ°æ—¶é—´

**æ™ºèƒ½ç¡çœ åˆ¤æ–­**
- åŸºäºé¢„è®¾çš„ç¡çœ çª—å£åˆ¤æ–­å½“å‰çŠ¶æ€
- ä¸‰ç§çŠ¶æ€è¾“å‡ºï¼šç¡çœ ä¸­ã€å³å°†ç¡çœ ã€ä¿æŒæ¸…é†’
- å¯é…ç½®çš„ç¡çœ æ—¶é—´åŒºé—´ï¼ˆå¦‚ 23:00 - 07:00ï¼‰
- æ”¯æŒåˆä¼‘æ—¶æ®µçš„å•ç‹¬é…ç½®ï¼ˆå¦‚ 12:00 - 13:00ï¼‰

**è§†è§‰çŠ¶æ€åé¦ˆ**
- ä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„ç•Œé¢ä¸»é¢˜è‰²
- ç»¿è‰²è¡¨ç¤ºæ¸…é†’çŠ¶æ€ï¼Œé»„è‰²è¡¨ç¤ºå³å°†ç¡çœ ï¼Œç´«è‰²è¡¨ç¤ºç¡çœ æ—¶é—´
- å¹³æ»‘çš„çŠ¶æ€è¿‡æ¸¡åŠ¨ç”»æ•ˆæœ

**ä¸ªæ€§åŒ–è®¾ç½®**
- è‡ªå®šä¹‰ç¡çœ æ—¶é—´æ®µ
- æé†’é˜ˆå€¼è®¾ç½®ï¼ˆç¡å‰å¤šå°‘åˆ†é’Ÿå¼€å§‹æé†’ï¼‰
- å¼€æœºè‡ªå¯åŠ¨é€‰é¡¹ï¼ˆå¯é€‰ï¼‰
- é€æ˜çª—å£æ¨¡å¼ï¼ˆå¯é€‰ï¼‰

### 2.2 è¾…åŠ©åŠŸèƒ½

- æ¸å˜å¼å±å¹•äº®åº¦è°ƒèŠ‚æé†’ï¼ˆé€‚ç”¨äºæ”¯æŒçš„ç¯å¢ƒï¼‰
- æ¯æ—¥ç¡çœ ç»Ÿè®¡æ‘˜è¦
- ç®€æ˜“çš„ç•ªèŒ„é’Ÿæ¨¡å¼ï¼ˆå¯é€‰æ‰©å±•ï¼‰
- å£°éŸ³æç¤ºå¼€å…³åŠéŸ³é‡æ§åˆ¶

---

## 3. æŠ€æœ¯éœ€æ±‚ä¸çº¦æŸ

### 3.1 æŠ€æœ¯æ ˆé€‰æ‹©

| å±‚æ¬¡ | æŠ€æœ¯é€‰å‹ | é€‰å‹ç†ç”± |
|------|----------|----------|
| å¼€å‘è¯­è¨€ | Python 3.8+ | è·¨å¹³å°ã€ä¸°å¯Œçš„GUIåº“æ”¯æŒã€ç®€æ´æ˜“ç»´æŠ¤ |
| GUIæ¡†æ¶ | Tkinterï¼ˆå†…ç½®ï¼‰æˆ– PyQt5ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰ | Tkinteré›¶ä¾èµ–æ‰“åŒ…ç®€å•ï¼ŒPyQt5åŠŸèƒ½æ›´ä¸°å¯Œ |
| æ—¶é—´å¤„ç† | datetimeã€timeæ¨¡å— | Pythonå†…ç½®ï¼Œç²¾ç¡®å¯é  |
| é…ç½®å­˜å‚¨ | JSONæ–‡ä»¶ | äººç±»å¯è¯»ã€æ˜“äºæ‰‹åŠ¨ç¼–è¾‘ |
| æ‰“åŒ…å‘å¸ƒ | PyInstaller | ç”Ÿæˆå•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åº |

### 3.2 ç³»ç»Ÿå…¼å®¹æ€§

- **Windows**: Windows 10åŠä»¥ä¸Šç‰ˆæœ¬å®Œå…¨æ”¯æŒ
- **macOS**: 10.14 (Mojave) åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œéœ€å¤„ç†èœå•æ é›†æˆ
- **Linux**: ä¸»æµå‘è¡Œç‰ˆï¼ˆUbuntuã€Fedoraç­‰ï¼‰ï¼Œä¾èµ–ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒ

### 3.3 æ€§èƒ½çº¦æŸ

- å†…å­˜å ç”¨ä¸è¶…è¿‡ 50MB
- CPUå ç”¨ç‡åœ¨ç©ºé—²çŠ¶æ€ä¸‹æ¥è¿‘ 0%
- ç•Œé¢å“åº”å»¶è¿Ÿä½äº 100ms
- æ—¶é—´åŒæ­¥ç²¾åº¦è¯¯å·®ä¸è¶…è¿‡ 1ç§’

### 3.4 å¤–éƒ¨ä¾èµ–é™åˆ¶

ä¸ºä¿æŒè½¯ä»¶è½»é‡ï¼Œå¤–éƒ¨ä¾èµ–åº”æ§åˆ¶åœ¨æœ€å°‘èŒƒå›´å†…ï¼š

```
# æ ¸å¿ƒä¾èµ–ï¼ˆå¿…éœ€ï¼‰
æ— é¢å¤–ä¾èµ–ï¼ˆä½¿ç”¨Pythonå†…ç½®åº“ï¼‰

# å¯é€‰å¢å¼ºä¾èµ–
PyQt5          # å¦‚æœéœ€è¦æ›´ç°ä»£çš„UI
pystray        # ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡æ”¯æŒ
plyer          # è·¨å¹³å°é€šçŸ¥
```

---

## 4. æ•°æ®ç»“æ„è®¾è®¡

### 4.1 é…ç½®æ•°æ®ç»“æ„ (config.json)

```json
{
  "version": "1.0.0",
  "settings": {
    "time_format": "24h",
    "startup_launch": false,
    "minimize_to_tray": true,
    "sound_enabled": true,
    "volume": 80
  },
  "sleep_schedule": {
    "primary": {
      "enabled": true,
      "start": "23:00",
      "end": "07:00",
      "reminder_minutes": 30
    },
    "nap_time": {
      "enabled": true,
      "start": "12:30",
      "end": "13:30",
      "reminder_minutes": 15
    }
  },
  "appearance": {
    "theme": "system",
    "opacity": 100,
    "custom_colors": {
      "awake": "#2ECC71",
      "soon": "#F39C12",
      "sleeping": "#9B59B6"
    }
  }
}
```

### 4.2 æ—¶é—´çŠ¶æ€æšä¸¾

```python
from enum import Enum

class SleepStatus(Enum):
    """ç¡çœ çŠ¶æ€æšä¸¾"""
    AWAKE = "awake"       # æ¸…é†’çŠ¶æ€
    SOON = "soon"         # å³å°†ç¡çœ 
    SLEEPING = "sleeping" # ç¡çœ æ—¶é—´
    NAP = "nap"           # åˆä¼‘æ—¶é—´
```

### 4.3 æ ¸å¿ƒç±»ç»“æ„

```python
class TimeManager:
    """æ—¶é—´ç®¡ç†æ ¸å¿ƒç±»"""
    def __init__(self):
        self.current_time: datetime
        self.status: SleepStatus
    
    def get_current_time() -> str
    def get_status() -> SleepStatus
    def is_sleep_time() -> bool
    def minutes_until_sleep() -> int

class ConfigManager:
    """é…ç½®ç®¡ç†ç±»"""
    def __init__(self, config_path: str):
        self.config: dict
    
    def load_config() -> dict
    def save_config(config: dict) -> bool
    def get_sleep_window() -> tuple[time, time]

class SleepClockApp:
    """ä¸»åº”ç”¨ç¨‹åºç±»"""
    def __init__(self):
        self.time_manager: TimeManager
        self.config_manager: ConfigManager
        self.ui: Union[Tk, QApplication]
    
    def run() -> None
    def update_display() -> None
    def check_sleep_status() -> None
```

---

## 5. ç®—æ³•è®¾è®¡

### 5.1 ç¡çœ çŠ¶æ€åˆ¤æ–­ç®—æ³•

```
Algorithm: DetermineSleepStatus
Input: current_time, sleep_window, reminder_threshold
Output: status (AWAKE/SOON/SLEEPING)

1. IF nap_time_enabled AND current_time IN nap_window THEN
2.     RETURN NAP
3. END IF

4. IF primary_sleep_window spans midnight THEN
5.     // å¤„ç†è·¨è¶Šåˆå¤œçš„ç¡çœ çª—å£ï¼ˆå¦‚ 23:00 - 07:00ï¼‰
6.     IF current_time >= window.start OR current_time < window.end THEN
7.         status = SLEEPING
8.     ELSE
9.         status = check_awake_status(current_time, window)
10.    END IF
11.ELSE
12.    // æ™®é€šç¡çœ çª—å£ï¼ˆåŒä¸€å¤©å†…ï¼‰
13.    IF current_time IN window THEN
14.        status = SLEEPING
15.    ELSE
16.        status = check_awake_status(current_time, window)
17.    END IF
18.END IF

19.RETURN status

Algorithm: check_awake_status
Input: current_time, sleep_window
Output: status (AWAKE/SOON)

1. time_to_sleep = minutes_until(sleep_window.start)
2. IF time_to_sleep <= reminder_threshold AND time_to_sleep > 0 THEN
3.     RETURN SOON
4. ELSE
5.     RETURN AWAKE
6. END IF
```

### 5.2 æ—¶é—´çª—å£åŒ…å«åˆ¤æ–­ç®—æ³•

```python
def is_time_in_window(current: time, start: time, end: time) -> bool:
    """
    åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦åœ¨æ—¶é—´çª—å£å†…
    å¤„ç†è·¨è¶Šåˆå¤œçš„æƒ…å†µ
    """
    if start <= end:
        # æ™®é€šæƒ…å†µï¼šåŒä¸€å¤©å†…çš„æ—¶é—´æ®µ
        return start <= current <= end
    else:
        # è·¨è¶Šåˆå¤œï¼š23:00 - 07:00 è¿™ç§æƒ…å†µ
        return current >= start or current <= end

def minutes_until(target_time: time) -> int:
    """è®¡ç®—è·ç¦»ç›®æ ‡æ—¶é—´çš„åˆ†é’Ÿæ•°"""
    now = datetime.now().time()
    target = target_time
    
    if now <= target:
        return (target.hour - now.hour) * 60 + (target.minute - now.minute)
    else:
        # è·¨è¶Šåˆå¤œï¼Œè®¡ç®—åˆ°æ˜å¤©çš„æ—¶é—´
        return (24 - now.hour + target.hour) * 60 - now.minute + target.minute
```

---

## 6. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 6.1 ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸŒ™ Sleep Clock              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—          â”‚
â”‚          â•‘   14:35:22    â•‘          â”‚
â”‚          â•‘   2024å¹´1æœˆ   â•‘          â”‚
â”‚          â•‘   æ˜ŸæœŸä¸‰      â•‘          â”‚
â”‚          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â”‚
â”‚                                     â”‚
â”‚    çŠ¶æ€: âœ… ä¿æŒæ¸…é†’ - 8å°æ—¶22åˆ†     â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [âš™ï¸ è®¾ç½®]  [ğŸ“Š ç»Ÿè®¡]  [ğŸšª é€€å‡º]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 äº¤äº’æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¯åŠ¨ç¨‹åº    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŠ è½½é…ç½®     â”‚â”€â”€â”€â”€â–¶â”‚  è¯»å–JSONé…ç½®    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå§‹åŒ–UI    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸»å¾ªç¯å¼€å§‹                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ¯ç§’æ›´æ–°æ˜¾ç¤ºæ—¶é—´           â”‚  â”‚
â”‚  â”‚  æ£€æŸ¥ç¡çœ çŠ¶æ€               â”‚  â”‚
â”‚  â”‚  æ›´æ–°UIé¢œè‰²å’Œæç¤º           â”‚â—€â”€â”¤
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†‘                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ ç”¨æˆ·æ“ä½œ
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [è®¾ç½®æŒ‰é’®] â†’ æ‰“å¼€è®¾ç½®é¢æ¿        â”‚
â”‚  [ç»Ÿè®¡æŒ‰é’®] â†’ æ˜¾ç¤ºç¡çœ ç»Ÿè®¡        â”‚
â”‚  [é€€å‡ºæŒ‰é’®] â†’ ä¿å­˜å¹¶é€€å‡º          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 è®¾ç½®ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       âš™ï¸ è®¾ç½® - ç¡çœ æ—¶é’Ÿ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚
â”‚  ğŸ• æ—¶é—´æ˜¾ç¤º                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â— 24å°æ—¶åˆ¶  â—‹ 12å°æ—¶åˆ¶ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                              â”‚
â”‚  ğŸ˜´ ç¡çœ æ—¶é—´è®¾ç½®              â”‚
â”‚  ä¸»ç¡çœ æ—¶æ®µ: 23:00 â–½ - 07:00 â–½ â”‚
â”‚  [âœ“] å¯ç”¨ç¡å‰æé†’             â”‚
â”‚  æå‰æé†’: [30] åˆ†é’Ÿ          â”‚
â”‚                              â”‚
â”‚  â˜€ï¸ åˆä¼‘æ—¶æ®µ                  â”‚
â”‚  [âœ“] å¯ç”¨åˆä¼‘æé†’             â”‚
â”‚  åˆä¼‘æ—¶é—´: 12:30 â–½ - 13:30 â–½  â”‚
â”‚                              â”‚
â”‚  ğŸ”” é€šçŸ¥è®¾ç½®                  â”‚
â”‚  [âœ“] å£°éŸ³æé†’                 â”‚
â”‚  [âœ“] ç³»ç»Ÿé€šçŸ¥                 â”‚
â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     [ğŸ’¾ ä¿å­˜]  [âŒ å–æ¶ˆ]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. é”™è¯¯å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ

### 7.1 å¼‚å¸¸ç±»å‹ä¸å¤„ç†ç­–ç•¥

| å¼‚å¸¸æƒ…å†µ | å¤„ç†æ–¹æ¡ˆ | ç”¨æˆ·åé¦ˆ |
|----------|----------|----------|
| é…ç½®æ–‡ä»¶æŸå | ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œæç¤ºç”¨æˆ· | æ˜¾ç¤ºå‹å¥½çš„æ¢å¤æç¤º |
| æ—¶é—´åŒæ­¥é—®é¢˜ | å®šæœŸæ ¡å‡†ï¼Œä½¿ç”¨ç³»ç»Ÿæ—¶é—´ | æ— æ„ŸçŸ¥å¤„ç† |
| UIæ¸²æŸ“å¤±è´¥ | å›é€€åˆ°åŸºç¡€æ˜¾ç¤ºæ¨¡å¼ | è®°å½•æ—¥å¿—ï¼Œæ˜¾ç¤ºé”™è¯¯å›¾æ ‡ |
| æ‰˜ç›˜å›¾æ ‡åˆ›å»ºå¤±è´¥ | æœ€å°åŒ–åˆ°ä»»åŠ¡æ /Dock | æ˜¾ç¤ºæç¤ºä¿¡æ¯ |
| éŸ³é¢‘æ’­æ”¾å¤±è´¥ | é™é»˜è·³è¿‡ï¼Œè®°å½•æ—¥å¿— | æ— å£°éŸ³æ’­æ”¾ |

### 7.2 è¾¹ç•Œæƒ…å†µå¤„ç†

```python
class EdgeCaseHandler:
    """è¾¹ç•Œæƒ…å†µå¤„ç†å™¨"""
    
    def handle_config_corruption(self) -> dict:
        """å¤„ç†é…ç½®æ–‡ä»¶æŸå"""
        # å¤‡ä»½æŸåçš„é…ç½®
        self._backup_corrupted_config()
        # è¿”å›é»˜è®¤é…ç½®
        return self._get_default_config()
    
    def handle_time_jump(self, old_time: datetime, new_time: datetime):
        """å¤„ç†æ—¶é—´è·³å˜ï¼ˆå¦‚æ—¶åŒºå˜æ›´ã€å¤ä»¤æ—¶ï¼‰"""
        if abs((new_time - old_time).total_seconds()) > 3600:
            # æ—¶é—´å˜åŒ–è¶…è¿‡1å°æ—¶ï¼Œé‡æ–°è¯„ä¼°çŠ¶æ€
            self._recalculate_status()
    
    def handle_midnight_crossing(self, sleep_time: time) -> bool:
        """å¤„ç†åˆå¤œè·¨è¶Š"""
        # ç¡®ä¿ç¡çœ æ—¶é—´è®¡ç®—æ­£ç¡®å¤„ç†è·¨åˆå¤œæƒ…å†µ
        return sleep_time.hour >= 23 or sleep_time.hour < 7
```

### 7.3 è¾“å…¥éªŒè¯

```python
from pydantic import BaseModel, validator
from typing import Optional

class SleepScheduleInput(BaseModel):
    """ç¡çœ é…ç½®è¾“å…¥éªŒè¯æ¨¡å‹"""
    start_time: str
    end_time: str
    reminder_minutes: Optional[int] = 30
    
    @validator('start_time', 'end_time')
    def validate_time_format(cls, v):
        if not re.match(r'^(?:[01]?\d|2[0-3]):[0-5]\d$', v):
            raise ValueError('æ—¶é—´æ ¼å¼å¿…é¡»ä¸º HH:MM')
        return v
    
    @validator('reminder_minutes')
    def validate_reminder_range(cls, v):
        if v < 0 or v > 120:
            raise ValueError('æé†’æ—¶é—´åº”åœ¨ 0-120 åˆ†é’Ÿä¹‹é—´')
        return v
```

---

## 8. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 8.1 æ—¶é—´æ›´æ–°ä¼˜åŒ–

- ä½¿ç”¨ `time.perf_counter()` è¿›è¡Œé«˜ç²¾åº¦è®¡æ—¶
- é¿å…é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨ç¼“å­˜æœºåˆ¶
- UIæ›´æ–°ä½¿ç”¨äº‹ä»¶é©±åŠ¨ï¼Œè€Œéè½®è¯¢

```python
class OptimizedClock:
    """ä¼˜åŒ–æ—¶é’Ÿç±»"""
    
    def __init__(self):
        self._last_update = 0
        self._cached_time = None
        self._update_interval = 1.0  # 1ç§’æ›´æ–°ä¸€æ¬¡
    
    def get_time(self) -> str:
        current = time.monotonic()
        
        # é™æµæ›´æ–°ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—
        if current - self._last_update >= self._update_interval:
            self._cached_time = datetime.now()
            self._last_update = current
        
        return self._cached_time.strftime(self.format)
```

### 8.2 å†…å­˜ç®¡ç†

- é…ç½®åŠ è½½ä½¿ç”¨æ‡’åŠ è½½æ¨¡å¼
- åŠæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„èµ„æº
- é¿å…å†…å­˜æ³„æ¼çš„å®šæ—¶æ¸…ç†æœºåˆ¶

### 8.3 å¯åŠ¨æ€§èƒ½

- å‡å°‘å¯åŠ¨æ—¶çš„IOæ“ä½œ
- é…ç½®æ–‡ä»¶ä½¿ç”¨å¢é‡åŠ è½½
- è€ƒè™‘åå°é¢„åŠ è½½ç­–ç•¥

---

## 9. é¡¹ç›®ç»“æ„ä¸æ–‡ä»¶ç»„ç»‡

```
sleep_clock/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ time_manager.py     # æ—¶é—´ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config_manager.py   # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ sleep_calculator.py # ç¡çœ è®¡ç®—ç®—æ³•
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main_window.py      # ä¸»çª—å£
â”‚   â”‚   â”œâ”€â”€ settings_dialog.py  # è®¾ç½®å¯¹è¯æ¡†
â”‚   â”‚   â””â”€â”€ styles.py           # æ ·å¼å®šä¹‰
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ validators.py       # è¾“å…¥éªŒè¯
â”‚   â”‚   â””â”€â”€ exceptions.py       # å¼‚å¸¸å®šä¹‰
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ default_config.json # é»˜è®¤é…ç½®
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_time_manager.py
â”‚   â”œâ”€â”€ test_sleep_calculator.py
â”‚   â””â”€â”€ test_config_manager.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ README.md
â”‚   â””â”€â”€ API_DOCUMENTATION.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ setup.py
â””â”€â”€ README.md
```

---

## 10. å¼€å‘é‡Œç¨‹ç¢‘

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬1-3å¤©ï¼‰
- [ ] é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„æ­å»º
- [ ] å®ç°æ—¶é—´è·å–ä¸æ˜¾ç¤º
- [ ] å®ç°åŸºç¡€çš„ç¡çœ çŠ¶æ€åˆ¤æ–­ç®—æ³•
- [ ] å®ŒæˆCLIç‰ˆæœ¬åŸå‹

### é˜¶æ®µäºŒï¼šGUIå¼€å‘ï¼ˆç¬¬4-6å¤©ï¼‰
- [ ] è®¾è®¡å¹¶å®ç°ä¸»ç•Œé¢
- [ ] å®ç°å®æ—¶æ—¶é’Ÿæ›´æ–°
- [ ] å®ç°çŠ¶æ€é¢œè‰²åˆ‡æ¢
- [ ] æ·»åŠ ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒ

### é˜¶æ®µä¸‰ï¼šé…ç½®ç³»ç»Ÿï¼ˆç¬¬7-9å¤©ï¼‰
- [ ] å®ç°JSONé…ç½®è¯»å†™
- [ ] å¼€å‘è®¾ç½®ç•Œé¢
- [ ] æ·»åŠ ç¡çœ æ—¶é—´è‡ªå®šä¹‰åŠŸèƒ½
- [ ] å®ç°é…ç½®éªŒè¯ä¸æ¢å¤

### é˜¶æ®µå››ï¼šå®Œå–„ä¸æµ‹è¯•ï¼ˆç¬¬10-12å¤©ï¼‰
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å¤šå¹³å°æµ‹è¯•
- [ ] æ–‡æ¡£ç¼–å†™ä¸æ‰“åŒ…

---

## 11. æ€»ç»“

æœ¬æŠ€æœ¯è§„æ ¼æ–‡æ¡£è¯¦ç»†é˜è¿°äº†ç¡çœ æ—¶é’Ÿåº”ç”¨çš„æ•´ä½“è®¾è®¡æ–¹æ¡ˆã€‚è½¯ä»¶ä»¥ç®€æ´é«˜æ•ˆä¸ºæ ¸å¿ƒåŸåˆ™ï¼Œé€šè¿‡Pythonå®ç°è·¨å¹³å°æ”¯æŒï¼Œä½¿ç”¨å†…ç½®GUIåº“ä¿è¯è½»é‡çº§éƒ¨ç½²ã€‚æ™ºèƒ½ç¡çœ åˆ¤æ–­ç®—æ³•èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«ç”¨æˆ·çš„ç¡çœ çŠ¶æ€ï¼Œå¹¶æä¾›åŠæ—¶çš„çŠ¶æ€åé¦ˆã€‚å®Œå–„çš„æ•°æ®ç»“æ„è®¾è®¡å’Œé”™è¯¯å¤„ç†æœºåˆ¶ç¡®ä¿äº†è½¯ä»¶çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

### ç¬¬äºŒé˜¶æ®µï¼šæŠ€æœ¯è®¾è®¡
<think>
The user wants me to create a comprehensive technical plan for a Python-based Sleep Clock application. The request is in Chinese and asks for:

1. Overall architecture and design patterns
2. Key components and their responsibilities
3. Data flow and processing logic
4. Integration points and external dependencies
5. Testing strategy and quality assurance

This is a follow-up to the previous technical specification document I created. I need to provide a more detailed implementation plan in Chinese.

Let me structure this as a formal technical design document covering all the requested aspects.
</think>

# Python ç¡çœ æ—¶é’Ÿåº”ç”¨ - è¯¦ç»†æŠ€æœ¯è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€æ€»ä½“æ¶æ„è®¾è®¡

### 1.1 æ¶æ„æ¦‚è¿°

æœ¬é¡¹ç›®é‡‡ç”¨**åˆ†å±‚æ¶æ„æ¨¡å¼**ï¼ˆLayered Architectureï¼‰ç»“åˆ**äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼ˆEvent-Driven Architectureï¼‰çš„æ··åˆæ¨¡å¼ã€‚è¿™ç§æ¶æ„é€‰æ‹©åŸºäºä»¥ä¸‹è€ƒé‡ï¼šç³»ç»Ÿéœ€è¦æ¸…æ™°çš„åŠŸèƒ½åˆ’åˆ†ä»¥ä¿æŒä»£ç å¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶æ—¶é’Ÿåº”ç”¨æœ¬è´¨ä¸Šæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼ˆæ¯ç§’æ›´æ–°ã€ç”¨æˆ·äº¤äº’ç­‰ï¼‰ï¼Œéœ€è¦çµæ´»çš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚

æ•´ä½“æ¶æ„åˆ†ä¸ºäº”ä¸ªä¸»è¦å±‚æ¬¡ï¼Œä»åº•å±‚åˆ°é¡¶å±‚ä¾æ¬¡ä¸ºï¼šåŸºç¡€è®¾æ–½å±‚ã€æ ¸å¿ƒæœåŠ¡å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨åè°ƒå±‚ã€‚æ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œï¼Œå±‚ä¸å±‚ä¹‹é—´é€šè¿‡å®šä¹‰è‰¯å¥½çš„æ¥å£è¿›è¡Œé€šä¿¡ï¼Œé¿å…ç›´æ¥ä¾èµ–ã€‚è¿™ç§è®¾è®¡ä½¿å¾—å„å±‚å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•ï¼Œä¹Ÿä¾¿äºåç»­çš„åŠŸèƒ½æ‰©å±•å’Œç»´æŠ¤ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åº”ç”¨åè°ƒå±‚ (Application Layer)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    MainApp (åº”ç”¨å…¥å£ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          è¡¨ç¤ºå±‚ (Presentation Layer)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MainWindow   â”‚ SettingsPanel â”‚ StatusDisplay â”‚  TrayIcon     â”‚    â”‚
â”‚  â”‚  (ä¸»çª—å£)      â”‚ (è®¾ç½®é¢æ¿)     â”‚ (çŠ¶æ€æ˜¾ç¤º)     â”‚ (æ‰˜ç›˜å›¾æ ‡)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ TimeManager   â”‚ SleepService  â”‚ ConfigService â”‚ Notification  â”‚    â”‚
â”‚  â”‚ (æ—¶é—´ç®¡ç†)     â”‚ (ç¡çœ æœåŠ¡)     â”‚ (é…ç½®æœåŠ¡)     â”‚ (é€šçŸ¥æœåŠ¡)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          æ ¸å¿ƒæœåŠ¡å±‚ (Core Services Layer)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ TimeProvider  â”‚ ConfigRepositoryâ”‚ Scheduler    â”‚ EventBus      â”‚    â”‚
â”‚  â”‚ (æ—¶é—´æä¾›è€…)   â”‚ (é…ç½®ä»“å‚¨)      â”‚ (è°ƒåº¦å™¨)      â”‚ (äº‹ä»¶æ€»çº¿)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ FileSystem    â”‚ SystemAPI     â”‚ Logger        â”‚ ErrorHandler  â”‚    â”‚
â”‚  â”‚ (æ–‡ä»¶ç³»ç»Ÿ)     â”‚ (ç³»ç»ŸAPI)      â”‚ (æ—¥å¿—)        â”‚ (é”™è¯¯å¤„ç†)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è®¾è®¡æ¨¡å¼åº”ç”¨

æœ¬é¡¹ç›®åœ¨æ¶æ„è®¾è®¡ä¸­ç»¼åˆè¿ç”¨äº†å¤šç§ç»è¿‡éªŒè¯çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

**å•ä¾‹æ¨¡å¼**åº”ç”¨äºé‚£äº›éœ€è¦å…¨å±€å”¯ä¸€å®ä¾‹çš„ç»„ä»¶ï¼Œå¦‚é…ç½®ç®¡ç†å™¨ã€äº‹ä»¶æ€»çº¿å’Œæ—¥å¿—ç³»ç»Ÿã€‚è¿™äº›ç»„ä»¶åœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åº”è¯¥ä¿æŒå•ä¸€çš„å®ä¾‹çŠ¶æ€ï¼Œä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œèµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚ä»¥é…ç½®ç®¡ç†å™¨ä¸ºä¾‹ï¼Œå¦‚æœåˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½å¯èƒ½ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€å‰¯æœ¬ï¼Œå¯¼è‡´é…ç½®ä¸åŒæ­¥çš„é—®é¢˜ã€‚

**è§‚å¯Ÿè€…æ¨¡å¼**åœ¨æ—¶é—´æ›´æ–°å’ŒçŠ¶æ€å˜åŒ–é€šçŸ¥ä¸­å‘æŒ¥æ ¸å¿ƒä½œç”¨ã€‚æ—¶é—´ç®¡ç†å™¨ä½œä¸ºè¢«è§‚å¯Ÿçš„ä¸»é¢˜ï¼Œå½“æ—¶é—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…è¿›è¡Œæ›´æ–°ã€‚è¿™ç§æ¨¡å¼è§£è€¦äº†æ—¶é—´äº§ç”Ÿè€…å’Œæ—¶é—´æ¶ˆè´¹è€…çš„ç›´æ¥ä¾èµ–ï¼Œä½¿å¾—ç³»ç»Ÿå¯ä»¥çµæ´»åœ°æ·»åŠ æ–°çš„æ˜¾ç¤ºç»„ä»¶æˆ–æœåŠ¡è€Œä¸å½±å“ç°æœ‰ä»£ç ã€‚

**ç­–ç•¥æ¨¡å¼**ç”¨äºå¤„ç†ä¸åŒçš„ç¡çœ è®¡ç®—ç­–ç•¥å’Œæ—¶é—´æ ¼å¼ç­–ç•¥ã€‚æ ¹æ®ç”¨æˆ·é…ç½®æˆ–è¿è¡Œæ—¶ç¯å¢ƒï¼Œç³»ç»Ÿå¯ä»¥é€‰æ‹©ä¸åŒçš„ç­–ç•¥æ¥è®¡ç®—ç¡çœ çŠ¶æ€æˆ–æ ¼å¼åŒ–æ—¶é—´è¾“å‡ºã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ·»åŠ æ–°çš„è®¡ç®—ç­–ç•¥æˆ–æ ¼å¼å˜å¾—ç®€å•ï¼Œåªéœ€å®ç°ç»Ÿä¸€çš„ç­–ç•¥æ¥å£å³å¯ã€‚

**çŠ¶æ€æ¨¡å¼**ç”¨äºç®¡ç†åº”ç”¨çš„ä¸åŒè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æ­£å¸¸è¿è¡ŒçŠ¶æ€ã€æœ€å°åŒ–çŠ¶æ€ã€ç¡çœ æ£€æµ‹çŠ¶æ€ç­‰ã€‚æ¯ä¸ªçŠ¶æ€å¯¹åº”ä¸€ä¸ªå…·ä½“çš„çŠ¶æ€ç±»ï¼Œå¤„ç†è¯¥çŠ¶æ€ä¸‹çš„ç‰¹å®šè¡Œä¸ºå’ŒçŠ¶æ€è½¬æ¢ã€‚è¿™ç§è®¾è®¡é¿å…äº†å¤§é‡çš„æ¡ä»¶åˆ†æ”¯ä»£ç ï¼Œä½¿çŠ¶æ€ç®¡ç†æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ã€‚

**ä»“å‚¨æ¨¡å¼**ç”¨äºæ•°æ®è®¿é—®å±‚çš„æŠ½è±¡ï¼Œå°†é…ç½®æ•°æ®çš„æŒä¹…åŒ–å’Œè¯»å–æ“ä½œå°è£…åœ¨ç»Ÿä¸€çš„æ¥å£åé¢ã€‚è¿™æ ·å¯ä»¥å°†æ•°æ®å­˜å‚¨çš„å…·ä½“å®ç°ï¼ˆå¦‚JSONæ–‡ä»¶ã€æ³¨å†Œè¡¨ã€ç³»ç»Ÿåå¥½ç­‰ï¼‰ä¸ä¸šåŠ¡é€»è¾‘å±‚éš”ç¦»ï¼Œä¾¿äºæ”¯æŒå¤šç§å­˜å‚¨åç«¯å’Œè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

### 1.3 ä¾èµ–æ³¨å…¥è®¾è®¡

ä¸ºäº†è¿›ä¸€æ­¥è§£è€¦ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨ä¾èµ–æ³¨å…¥æ¨¡å¼ã€‚é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥æˆ–å±æ€§æ³¨å…¥çš„æ–¹å¼ï¼Œç»„ä»¶ä¸ç›´æ¥åˆ›å»ºå…¶ä¾èµ–çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä»å¤–éƒ¨æ¥æ”¶ä¾èµ–å¯¹è±¡ã€‚è¿™ç§è®¾è®¡å¸¦æ¥äº†ä¸‰ä¸ªä¸»è¦å¥½å¤„ï¼šé¦–å…ˆï¼Œç»„ä»¶çš„ä¾èµ–å…³ç³»å˜å¾—æ˜¾å¼å’Œæ¸…æ™°ï¼›å…¶æ¬¡ï¼Œå¯ä»¥è½»æ¾æ›¿æ¢ä¾èµ–å®ç°ï¼ˆå¦‚ä½¿ç”¨mockå¯¹è±¡è¿›è¡Œæµ‹è¯•ï¼‰ï¼›æœ€åï¼Œç»„ä»¶çš„èŒè´£æ›´åŠ å•ä¸€ï¼Œä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚

```
# ä¾èµ–æ³¨å…¥ç¤ºä¾‹ä»£ç ç»“æ„
class MainWindow:
    def __init__(
        self,
        time_manager: TimeManagerProtocol,
        config_service: ConfigServiceProtocol,
        event_bus: EventBus,
        ui_factory: UIComponentFactory
    ):
        # é€šè¿‡æ³¨å…¥çš„æ¥å£è€Œéå…·ä½“å®ç°ç¼–ç¨‹
        self._time_manager = time_manager
        self._config_service = config_service
        self._event_bus = event_bus
        self._ui_factory = ui_factory
```

---

## äºŒã€æ ¸å¿ƒç»„ä»¶èŒè´£è¯¦è§£

### 2.1 åŸºç¡€è®¾æ–½å±‚ç»„ä»¶

**FileSystem æ¨¡å—**æ‰¿æ‹…æ‰€æœ‰ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’çš„è´£ä»»ï¼Œæ˜¯æ•´ä¸ªåº”ç”¨æ•°æ®æŒä¹…åŒ–çš„åŸºç¡€ã€‚è¯¥æ¨¡å—å°è£…äº†Pythonæ ‡å‡†åº“ä¸­çš„æ–‡ä»¶æ“ä½œå‡½æ•°ï¼Œæä¾›äº†æ›´é«˜çº§åˆ«çš„æŠ½è±¡æ¥å£ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®æ–‡ä»¶çš„åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤ï¼›é»˜è®¤é…ç½®æ¨¡æ¿çš„å­˜å‚¨å’Œæ¢å¤ï¼›é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬è¿ç§»å’Œå¤‡ä»½ç®¡ç†ï¼›ä»¥åŠæ—¥å¿—æ–‡ä»¶çš„è½®è½¬å’Œç®¡ç†ã€‚åœ¨å®ç°ä¸Šï¼Œè¯¥æ¨¡å—ç¡®ä¿æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½ç»è¿‡é€‚å½“çš„å¼‚å¸¸å¤„ç†ï¼Œé¿å…å› æ–‡ä»¶æƒé™é—®é¢˜æˆ–ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´åº”ç”¨å´©æºƒã€‚åŒæ—¶ï¼Œæ¨¡å—æä¾›äº†è·¯å¾„å¤„ç†çš„è·¨å¹³å°å°è£…ï¼Œç¡®ä¿åœ¨Windowsã€macOSå’ŒLinuxä¸Šçš„è¡Œä¸ºä¸€è‡´æ€§ã€‚

**SystemAPI æ¨¡å—**ä½œä¸ºåº”ç”¨ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„ç»Ÿä¸€å…¥å£ï¼Œå°è£…äº†æ‰€æœ‰å¹³å°ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ã€‚è¯¥æ¨¡å—çš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼šè·å–å’Œè®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼ˆç”¨äºæ—¶åŒºå¤„ç†ï¼‰ï¼›ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡çš„åˆ›å»ºå’Œç®¡ç†ï¼›ç³»ç»Ÿé€šçŸ¥çš„å‘é€ï¼›å¼€æœºè‡ªå¯åŠ¨çš„æ³¨å†Œå’Œå–æ¶ˆï¼›ä»¥åŠå±å¹•äº®åº¦å’Œç”µæºçŠ¶æ€çš„æŸ¥è¯¢ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚ä¸ºäº†å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œè¯¥æ¨¡å—åœ¨å†…éƒ¨ä½¿ç”¨æ¡ä»¶å¯¼å…¥å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œä¸ºæ¯ä¸ªæ”¯æŒçš„å¹³å°æä¾›å…·ä½“çš„å®ç°ç±»ã€‚åº”ç”¨ä»£ç é€šè¿‡ç»Ÿä¸€çš„æ¥å£è°ƒç”¨ç³»ç»ŸåŠŸèƒ½ï¼Œæ— éœ€å…³å¿ƒåº•å±‚å¹³å°å·®å¼‚ã€‚

**Logger æ¨¡å—**æä¾›ç»Ÿä¸€çš„æ—¥å¿—è®°å½•æœåŠ¡ï¼Œæ˜¯åº”ç”¨å¯è§‚æµ‹æ€§çš„åŸºç¡€ã€‚è¯¥æ¨¡å—åŸºäºPythonçš„loggingæ¨¡å—æ„å»ºï¼Œæä¾›äº†å¤šçº§åˆ«çš„æ—¥å¿—è¾“å‡ºï¼ˆDEBUGã€INFOã€WARNINGã€ERRORã€CRITICALï¼‰ã€æ—¥å¿—æ ¼å¼åŒ–ã€æ—¥å¿—æ–‡ä»¶è½®è½¬å’Œæ—¥å¿—è¿‡æ»¤ç­‰åŠŸèƒ½ã€‚æ—¥å¿—è¾“å‡ºåŒæ—¶æ”¯æŒæ§åˆ¶å°å’Œæ–‡ä»¶ä¸¤ç§æ–¹å¼ï¼Œæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œå¤§å°å¯ä»¥é…ç½®ã€‚æ¨¡å—è¿˜æä¾›äº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ”¯æŒï¼Œä¾¿äºåœ¨ç‰¹å®šä»£ç å—ä¸­ä¸´æ—¶è°ƒæ•´æ—¥å¿—çº§åˆ«æˆ–æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ‰€æœ‰å…³é”®æ“ä½œï¼ˆå¦‚é…ç½®ä¿å­˜ã€çŠ¶æ€è½¬æ¢ã€å¼‚å¸¸æ•è·ï¼‰éƒ½ä¼šè®°å½•ç›¸åº”çš„æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¯Šæ–­å’Œæ€§èƒ½åˆ†æã€‚

**ErrorHandler æ¨¡å—**æ˜¯åº”ç”¨å¼‚å¸¸å¤„ç†ç­–ç•¥çš„æ ¸å¿ƒï¼Œè´Ÿè´£æ•è·ã€å¤„ç†å’Œæ¢å¤å„ç§å¼‚å¸¸æƒ…å†µã€‚è¯¥æ¨¡å—å®ç°äº†å®Œæ•´çš„å¼‚å¸¸åˆ†ç±»ä½“ç³»ï¼Œå°†å¼‚å¸¸åˆ†ä¸ºé…ç½®å¼‚å¸¸ã€æ—¶é—´è®¡ç®—å¼‚å¸¸ã€UIå¼‚å¸¸ã€æ–‡ä»¶ç³»ç»Ÿå¼‚å¸¸ç­‰ç±»åˆ«ï¼Œæ¯ç§ç±»åˆ«éƒ½æœ‰å¯¹åº”çš„å¤„ç†ç­–ç•¥ã€‚å¯¹äºå¯æ¢å¤çš„å¼‚å¸¸ï¼Œæ¨¡å—å°è¯•è‡ªåŠ¨æ¢å¤å¹¶è®°å½•è­¦å‘Šæ—¥å¿—ï¼›å¯¹äºä¸å¯æ¢å¤çš„ä¸¥é‡å¼‚å¸¸ï¼Œæ¨¡å—ä¼šæ˜¾ç¤ºå‹å¥½çš„ç”¨æˆ·æç¤ºå¹¶å°è¯•ä¼˜é›…åœ°å…³é—­åº”ç”¨ã€‚è¯¥æ¨¡å—è¿˜è´Ÿè´£å°†å¼‚å¸¸ä¿¡æ¯è½¬æ¢ä¸ºç”¨æˆ·å¯ç†è§£çš„é”™è¯¯æ¶ˆæ¯ï¼ŒåŒæ—¶ä¿ç•™è¯¦ç»†çš„æŠ€æœ¯ä¿¡æ¯ä¾›å¼€å‘è€…è°ƒè¯•ä½¿ç”¨ã€‚

### 2.2 æ ¸å¿ƒæœåŠ¡å±‚ç»„ä»¶

**TimeProvider ç±»**æ˜¯æ—¶é—´ç›¸å…³æ“ä½œçš„å•ä¸€äº‹å®æ¥æºï¼Œæä¾›ç²¾ç¡®çš„æ—¶é—´è·å–å’Œè®¡ç®—åŠŸèƒ½ã€‚è¯¥ç±»çš„æ ¸å¿ƒæ–¹æ³•åŒ…æ‹¬ï¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´çš„ç²¾ç¡®è¡¨ç¤ºï¼›è®¡ç®—ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„æ—¶é—´å·®ï¼›åˆ¤æ–­æŸä¸ªæ—¶é—´ç‚¹æ˜¯å¦åœ¨ç»™å®šçš„æ—¶é—´çª—å£å†…ï¼›ä»¥åŠè®¡ç®—è·ç¦»æŸä¸ªæ—¶é—´ç‚¹çš„åˆ†é’Ÿæ•°ã€‚ä¸ºäº†ç¡®ä¿æ—¶é—´æ˜¾ç¤ºçš„å‡†ç¡®æ€§ï¼ŒTimeProviderä½¿ç”¨ç³»ç»Ÿæ—¶é’Ÿè€ŒéCPUæ—¶é’Ÿï¼Œå¹¶è€ƒè™‘äº†ç³»ç»Ÿæ—¶é—´è°ƒæ•´çš„æƒ…å†µï¼ˆé€šè¿‡ç›‘æ§æ—¶é—´è·³å˜ï¼‰ã€‚è¯¥ç±»è¿˜æä¾›äº†æ—¶é—´æ ¼å¼åŒ–åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§é¢„å®šä¹‰çš„æ ¼å¼å’Œè‡ªå®šä¹‰æ ¼å¼æ¨¡æ¿ã€‚

**ConfigRepository ç±»**å°è£…äº†æ‰€æœ‰é…ç½®æ•°æ®çš„è®¿é—®é€»è¾‘ï¼Œå°†é…ç½®çš„å­˜å‚¨æ ¼å¼å’Œä½ç½®ä¸ä¸Šå±‚æœåŠ¡éš”ç¦»ã€‚è¯¥ç±»æ”¯æŒJSONæ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨æ‰å¹³çš„é”®åç»“æ„ä¾¿äºäººç±»é˜…è¯»å’Œæ‰‹åŠ¨ç¼–è¾‘ã€‚æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼šåŠ è½½å¹¶è§£æé…ç½®æ–‡ä»¶ï¼›éªŒè¯é…ç½®æ•°æ®çš„å®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§ï¼›æä¾›é…ç½®æ•°æ®çš„è¯»å–å’Œä¿®æ”¹æ¥å£ï¼›ä»¥åŠä¿å­˜é…ç½®åˆ°æ–‡ä»¶ï¼ˆæ”¯æŒåŸå­å†™å…¥ï¼Œé¿å…å†™å…¥è¿‡ç¨‹ä¸­æ–­å¯¼è‡´é…ç½®æŸåï¼‰ã€‚è¯¥ç±»è¿˜å®ç°äº†é…ç½®å˜æ›´ç›‘å¬æœºåˆ¶ï¼Œå½“é…ç½®è¢«ä¿®æ”¹æ—¶é€šçŸ¥ç›¸å…³ç»„ä»¶è¿›è¡Œåˆ·æ–°ã€‚

**Scheduler ç±»**æä¾›ç²¾ç¡®çš„ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ï¼Œæ˜¯å®ç°å®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒç»„ä»¶ã€‚è™½ç„¶Pythonçš„threadingæ¨¡å—å’Œtimeæ¨¡å—å¯ä»¥å®ç°å®šæ—¶åŠŸèƒ½ï¼Œä½†Schedulerç±»åœ¨æ­¤åŸºç¡€ä¸Šæä¾›äº†æ›´å¼ºå¤§çš„èƒ½åŠ›ï¼šæ”¯æŒä¸€æ¬¡æ€§ä»»åŠ¡å’Œå‘¨æœŸæ€§ä»»åŠ¡ï¼›ç²¾ç¡®çš„æ—¶é—´ç‚¹è§¦å‘è€Œéç®€å•çš„é—´éš”è§¦å‘ï¼›ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€è·Ÿè¸ªå’Œå¤±è´¥å¤„ç†ï¼›ä»¥åŠä»»åŠ¡å–æ¶ˆå’Œæš‚åœåŠŸèƒ½ã€‚åœ¨æœ¬åº”ç”¨ä¸­ï¼ŒSchedulerç”¨äºæ¯ç§’è§¦å‘æ—¶é—´æ›´æ–°ã€ç¡çœ çŠ¶æ€æ£€æŸ¥å’Œå®šæ—¶æé†’ç­‰åŠŸèƒ½ã€‚

**EventBus ç±»**å®ç°äº‹ä»¶é©±åŠ¨çš„é€šä¿¡æœºåˆ¶ï¼Œæ˜¯å„ç»„ä»¶ä¹‹é—´æ¾è€¦åˆé€šä¿¡çš„ä¸»è¦æ–¹å¼ã€‚è¯¥ç±»åŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼å®ç°ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§äº‹ä»¶åˆ†å‘æ¨¡å¼ã€‚äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼šæ—¶é—´æ›´æ–°äº‹ä»¶ï¼ˆæ¯ç§’è§¦å‘ï¼‰ï¼›çŠ¶æ€å˜æ›´äº‹ä»¶ï¼ˆç¡çœ çŠ¶æ€æ”¹å˜æ—¶è§¦å‘ï¼‰ï¼›é…ç½®å˜æ›´äº‹ä»¶ï¼ˆç”¨æˆ·ä¿®æ”¹è®¾ç½®æ—¶è§¦å‘ï¼‰ï¼›ä»¥åŠç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆæŒ‰é’®ç‚¹å‡»ã€èœå•é€‰æ‹©ç­‰ï¼‰ã€‚EventBusè¿˜æ”¯æŒäº‹ä»¶ä¼˜å…ˆçº§ï¼Œç¡®ä¿é‡è¦äº‹ä»¶èƒ½å¤Ÿä¼˜å…ˆå¤„ç†ã€‚ä¸ºäº†é¿å…äº‹ä»¶å¾ªç¯å’Œå†…å­˜æ³„æ¼ï¼Œè¯¥ç±»å®ç°äº†äº‹ä»¶è®¢é˜…çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚

### 2.3 ä¸šåŠ¡é€»è¾‘å±‚ç»„ä»¶

**TimeManager ç±»**æ˜¯æ—¶é—´ç®¡ç†çš„ä¸šåŠ¡é€»è¾‘æ ¸å¿ƒï¼Œåè°ƒæ—¶é—´è·å–ã€æ ¼å¼åŒ–å’ŒçŠ¶æ€åˆ¤æ–­ç­‰æ“ä½œã€‚è¯¥ç±»ç»´æŠ¤å½“å‰æ—¶é—´çš„çŠ¶æ€ï¼Œå¹¶æä¾›åªè¯»å±æ€§ä¾›å…¶ä»–ç»„ä»¶æŸ¥è¯¢ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼šæ ¼å¼åŒ–æ—¶é—´ä¸ºå­—ç¬¦ä¸²ç”¨äºæ˜¾ç¤ºï¼›è®¡ç®—è·ç¦»ä¸‹ä¸€ä¸ªç¡çœ æ—¶é—´ç‚¹çš„å‰©ä½™æ—¶é—´ï¼›ä»¥åŠç¡®å®šå½“å‰åº”è¯¥æ˜¾ç¤ºçš„ç¡çœ çŠ¶æ€ï¼ˆæ¸…é†’/å³å°†ç¡çœ /ç¡çœ ä¸­/åˆä¼‘ï¼‰ã€‚TimeManagerè®¢é˜…TimeProviderçš„æ—¶é—´æ›´æ–°äº‹ä»¶ï¼Œåœ¨æ—¶é—´å˜åŒ–æ—¶é‡æ–°è®¡ç®—çŠ¶æ€ï¼Œå¹¶é€šè¿‡EventBuså‘å¸ƒçŠ¶æ€å˜æ›´äº‹ä»¶ã€‚è¿™ç§è®¾è®¡ä½¿å¾—UIå±‚å¯ä»¥å®Œå…¨ä¸“æ³¨äºæ˜¾ç¤ºé€»è¾‘ï¼Œè€Œæ—¶é—´è®¡ç®—çš„å¤æ‚æ€§è¢«å°è£…åœ¨ä¸šåŠ¡é€»è¾‘å±‚ä¸­ã€‚

**SleepService ç±»**å®ç°æ‰€æœ‰ä¸ç¡çœ ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ˜¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åº”è¯¥ç¡è§‰çš„æ ¸å¿ƒå¼•æ“ã€‚è¯¥ç±»å°è£…äº†å¤æ‚çš„ç¡çœ æ—¶é—´åˆ¤æ–­ç®—æ³•ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç†è·¨è¶Šåˆå¤œçš„æ—¶é—´çª—å£ã€åˆä¼‘æ—¶æ®µçš„ä¼˜å…ˆåˆ¤æ–­ã€ä»¥åŠæé†’æ—¶é—´çš„è®¡ç®—ã€‚æ ¸å¿ƒæ–¹æ³•åŒ…æ‹¬ï¼šåˆ¤æ–­å½“å‰æ˜¯å¦åœ¨ç¡çœ çª—å£å†…ï¼›åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨åˆä¼‘çª—å£å†…ï¼›è®¡ç®—è·ç¦»ç¡çœ å¼€å§‹æˆ–ç»“æŸçš„å‰©ä½™æ—¶é—´ï¼›ä»¥åŠæ ¹æ®å½“å‰æ—¶é—´å’Œé…ç½®ç¡®å®šåº”è¯¥æ˜¾ç¤ºçš„çŠ¶æ€ã€‚SleepServiceè¿˜ç»´æŠ¤ç¡çœ ç»Ÿè®¡æ•°æ®ï¼Œå¦‚ä»Šæ—¥ç¡çœ æ—¶é•¿ã€è¿ç»­è§„å¾‹ç¡çœ å¤©æ•°ç­‰ï¼Œè¿™äº›æ•°æ®å¯ç”¨äºç¡çœ è´¨é‡åˆ†æåŠŸèƒ½ã€‚

**ConfigService ç±»**æä¾›é…ç½®ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œå°†åŸå§‹çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºåº”ç”¨å¯ä»¥ä½¿ç”¨çš„å½¢å¼ã€‚è¯¥ç±»çš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼šç®¡ç†å½“å‰ç”Ÿæ•ˆçš„é…ç½®ï¼ˆå†…å­˜ä¸­çš„é…ç½®å‰¯æœ¬ï¼‰ï¼›å¤„ç†é…ç½®å˜æ›´å¹¶æä¾›å˜æ›´é€šçŸ¥ï¼›éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§å¹¶åœ¨å¿…è¦æ—¶åº”ç”¨é»˜è®¤å€¼ï¼›ä»¥åŠå¤„ç†é…ç½®çš„å¯¼å…¥å’Œå¯¼å‡ºã€‚ConfigServiceè¿˜å®ç°äº†é…ç½®çƒ­æ›´æ–°æœºåˆ¶ï¼Œå½“é…ç½®æ–‡ä»¶è¢«å¤–éƒ¨ä¿®æ”¹æ—¶ï¼Œåº”ç”¨å¯ä»¥æ£€æµ‹åˆ°å˜åŒ–å¹¶è‡ªåŠ¨åˆ·æ–°é…ç½®ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚

**NotificationService ç±»**å¤„ç†æ‰€æœ‰ç”¨æˆ·é€šçŸ¥çš„å‘é€å’Œæ˜¾ç¤ºã€‚è¯¥ç±»æ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼šåº”ç”¨å†…çš„çŠ¶æ€æ æç¤ºï¼›ç³»ç»Ÿé€šçŸ¥ï¼ˆWindowsçš„Toasté€šçŸ¥ã€macOSçš„Notification Centerã€Linuxçš„Desktop Notificationsï¼‰ï¼›ä»¥åŠå£°éŸ³æé†’ã€‚NotificationServiceé‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œæ ¹æ®é…ç½®é€‰æ‹©ä½¿ç”¨å“ªç§é€šçŸ¥æ–¹å¼ï¼Œå¹¶å¤„ç†ä¸åŒå¹³å°ä¹‹é—´çš„å·®å¼‚ã€‚è¯¥ç±»è¿˜å®ç°äº†é€šçŸ¥çš„èšåˆåŠŸèƒ½ï¼Œé¿å…åœ¨çŸ­æ—¶é—´å†…å‘é€å¤§é‡é‡å¤é€šçŸ¥æ‰“æ‰°ç”¨æˆ·ã€‚

### 2.4 è¡¨ç¤ºå±‚ç»„ä»¶

**MainWindow ç±»**æ˜¯åº”ç”¨çš„ä¸»çª—å£ï¼Œè´Ÿè´£æ˜¾ç¤ºæ—¶é’Ÿå’ŒçŠ¶æ€ä¿¡æ¯ã€‚è¯¥çª—å£é‡‡ç”¨ç®€æ´çš„è®¾è®¡ï¼ŒèƒŒæ™¯è‰²æ ¹æ®å½“å‰ç¡çœ çŠ¶æ€åŠ¨æ€å˜åŒ–ã€‚ä¸»è¦æ˜¾ç¤ºå…ƒç´ åŒ…æ‹¬ï¼šå¤§å­—å·çš„æ—¶é—´æ˜¾ç¤ºï¼ˆæ—¶:åˆ†:ç§’æ ¼å¼ï¼‰ï¼›æ—¥æœŸå’Œæ˜ŸæœŸä¿¡æ¯ï¼›å½“å‰çŠ¶æ€æ–‡å­—æè¿°ï¼›ä»¥åŠè·ç¦»å…³é”®æ—¶é—´ç‚¹çš„å€’è®¡æ—¶ã€‚çª—å£è¿˜åŒ…å«èœå•æ å’Œå·¥å…·æ ï¼Œæä¾›è®¿é—®è®¾ç½®ã€ç»Ÿè®¡ç­‰åŠŸèƒ½çš„å…¥å£ã€‚ä¸»çª—å£è®¢é˜…TimeManagerçš„çŠ¶æ€æ›´æ–°äº‹ä»¶ï¼Œåœ¨çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºå†…å®¹å’Œä¸»é¢˜è‰²ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œçª—å£æ”¯æŒå¤šç§å¤§å°è°ƒæ•´æ¨¡å¼ï¼šå…¨å±æ¨¡å¼ã€ç´§å‡‘æ¨¡å¼å’Œè¿·ä½ æ¨¡å¼ã€‚

**SettingsPanel ç±»**å®ç°åº”ç”¨çš„è®¾ç½®ç•Œé¢ï¼Œæä¾›é…ç½®ä¿®æ”¹çš„å›¾å½¢ç•Œé¢ã€‚è¯¥é¢æ¿ä½¿ç”¨æ ‡ç­¾é¡µç»„ç»‡ä¸åŒç±»åˆ«çš„è®¾ç½®ï¼šæ—¶é—´æ˜¾ç¤ºè®¾ç½®ï¼ˆæ ¼å¼ã€æ—¶åŒºï¼‰ï¼›ç¡çœ æ—¶é—´è®¾ç½®ï¼ˆä¸»ç¡çœ æ—¶æ®µã€åˆä¼‘æ—¶æ®µï¼‰ï¼›é€šçŸ¥è®¾ç½®ï¼ˆå£°éŸ³ã€ç³»ç»Ÿé€šçŸ¥ã€æé†’é˜ˆå€¼ï¼‰ï¼›ä»¥åŠå¤–è§‚è®¾ç½®ï¼ˆä¸»é¢˜ã€é€æ˜åº¦ã€é¢œè‰²æ–¹æ¡ˆï¼‰ã€‚SettingsPanelä¸ConfigServiceç´§å¯†é›†æˆï¼Œåœ¨ç”¨æˆ·ä¿®æ”¹è®¾ç½®æ—¶å®æ—¶éªŒè¯å¹¶åº”ç”¨æ›´æ”¹ã€‚è¯¥é¢æ¿è¿˜æä¾›äº†æ¢å¤é»˜è®¤è®¾ç½®å’Œå¯¼å‡ºé…ç½®çš„é€‰é¡¹ã€‚

**StatusDisplay ç±»**æ˜¯ä¸“é—¨ç”¨äºæ˜¾ç¤ºç¡çœ çŠ¶æ€çš„ç»„ä»¶ï¼Œå¯ä»¥åµŒå…¥åˆ°ä¸»çª—å£æˆ–å…¶ä»–å®¹å™¨ä¸­ã€‚è¯¥ç»„ä»¶ä»¥æ›´ç›´è§‚çš„æ–¹å¼å±•ç¤ºå½“å‰çš„ç¡çœ çŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼šçŠ¶æ€å›¾æ ‡ï¼ˆå¤ªé˜³ã€æœˆäº®ã€æ•å¤´ç­‰ï¼‰ï¼›çŠ¶æ€æ–‡å­—æè¿°ï¼›è·ç¦»ä¸‹ä¸€ä¸ªçŠ¶æ€å˜åŒ–çš„å€’è®¡æ—¶ï¼›ä»¥åŠè¿›åº¦æ¡æ˜¾ç¤ºå½“å¤©çš„æ—¶é—´åˆ†é…ã€‚StatusDisplayæ”¯æŒå¤šç§ä¸»é¢˜å’ŒåŠ¨ç”»æ•ˆæœï¼Œä½¿çŠ¶æ€å±•ç¤ºæ›´åŠ ç”ŸåŠ¨å’Œæ˜“äºç†è§£ã€‚

**TrayIcon ç±»**å®ç°ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡åŠŸèƒ½ï¼Œä½¿åº”ç”¨å¯ä»¥åœ¨åå°è¿è¡Œæ—¶ä»èƒ½è¢«ç”¨æˆ·æ„ŸçŸ¥å’Œè®¿é—®ã€‚æ‰˜ç›˜å›¾æ ‡æ ¹æ®å½“å‰çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„å›¾æ ‡ï¼ˆæ¸…é†’ã€å³å°†ç¡çœ ã€ç¡çœ ä¸­ï¼‰ï¼Œå¹¶æ”¯æŒå³é”®èœå•æä¾›å¿«é€Ÿæ“ä½œå…¥å£ã€‚ç”¨æˆ·å¯ä»¥é…ç½®åœ¨æ‰˜ç›˜å›¾æ ‡ä¸Šæ˜¾ç¤ºçš„ä¿¡æ¯å†…å®¹ï¼Œå¦‚å½“å‰æ—¶é—´æˆ–å€’è®¡æ—¶ã€‚åœ¨æŸäº›å¹³å°ä¸Šï¼Œæ‰˜ç›˜å›¾æ ‡è¿˜å¯ä»¥æ˜¾ç¤ºé€šçŸ¥å¾½ç« æ•°å­—ã€‚

---

## ä¸‰ã€æ•°æ®æµä¸å¤„ç†é€»è¾‘

### 3.1 æ ¸å¿ƒæ•°æ®æµ

æœ¬åº”ç”¨çš„æ•°æ®æµéµå¾ªæ¸…æ™°çš„æ–¹å‘æ€§ï¼šæ•°æ®ä»åº•å±‚å‘ä¸Šå±‚æµåŠ¨ï¼Œæœ€ç»ˆå‘ˆç°åœ¨ç”¨æˆ·ç•Œé¢ä¸Šï¼›å½“ç”¨æˆ·è¿›è¡Œæ“ä½œæ—¶ï¼Œæ“ä½œæŒ‡ä»¤ä»ä¸Šå‘ä¸‹ä¼ é€’ï¼Œè§¦å‘ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™ç§åŒå‘æ•°æ®æµè®¾è®¡ç¡®ä¿äº†å„å±‚ä¹‹é—´çš„æ¸…æ™°è¾¹ç•Œï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„å“åº”æ€§ã€‚

```
æ•°æ®æµå›¾ - æ—¶é—´æ›´æ–°ä¸çŠ¶æ€æ˜¾ç¤ºæµç¨‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å¤–éƒ¨äº‹ä»¶è§¦å‘                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ç³»ç»Ÿæ—¶é’Ÿ  â”‚    â”‚ ç”¨æˆ·æ“ä½œ  â”‚    â”‚ å®šæ—¶å™¨   â”‚    â”‚ é…ç½®å˜æ›´  â”‚           â”‚
â”‚  â”‚  æ»´ç­”å£°   â”‚    â”‚ ç‚¹å‡»è®¾ç½®  â”‚    â”‚ è§¦å‘å™¨   â”‚    â”‚ æ–‡ä»¶ç›‘å¬  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EventBus (äº‹ä»¶æ€»çº¿)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  TIME_TICK â”‚ STATE_CHANGED â”‚ CONFIG_CHANGED â”‚ USER_ACTION       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼               â–¼               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ TimeManager â”‚ â”‚ SleepServiceâ”‚ â”‚  MainWindow â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚               â”‚               â”‚
                â–¼               â”‚               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚               â”‚
         â”‚ TimeProviderâ”‚â—€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                â”‚                              â”‚
                â–¼                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
         â”‚ ConfigServiceâ”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                â”‚                              â”‚
                â–¼                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
         â”‚ ConfigRepositoryâ”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                â”‚                              â”‚
                â–¼                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           FileSystem                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ—¶é—´æ›´æ–°å¤„ç†æµç¨‹

æ—¶é—´æ›´æ–°æ˜¯åº”ç”¨æœ€é¢‘ç¹çš„æ“ä½œï¼Œæ¯ç§’è§¦å‘ä¸€æ¬¡ã€‚å®Œæ•´çš„æ—¶é—´æ›´æ–°å¤„ç†æµç¨‹æ¶‰åŠå¤šä¸ªç»„ä»¶çš„åä½œï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤è¯´æ˜ã€‚

é¦–å…ˆï¼ŒSchedulerç»„ä»¶åœ¨æ¯ç§’çš„å›ºå®šæ—¶åˆ»è§¦å‘TIME_TICKäº‹ä»¶ã€‚è¿™ä¸ªæ—¶é—´é—´éš”å¯ä»¥é€šè¿‡é…ç½®è°ƒæ•´ï¼Œä½†é»˜è®¤ä½¿ç”¨1ç§’ä»¥ç¡®ä¿æ˜¾ç¤ºçš„æµç•…æ€§ã€‚äº‹ä»¶è§¦å‘åï¼ŒEventBuså°†äº‹ä»¶åˆ†å‘ç»™æ‰€æœ‰è®¢é˜…äº†è¯¥äº‹ä»¶çš„å¤„ç†å™¨ã€‚

TimeManageræ”¶åˆ°TIME_TICKäº‹ä»¶åï¼Œé¦–å…ˆè°ƒç”¨TimeProviderè·å–å½“å‰ç²¾ç¡®æ—¶é—´ã€‚ç„¶åï¼Œæ ¹æ®è·å–çš„æ—¶é—´è®¡ç®—æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰ã€‚æ¥ç€ï¼ŒTimeManagerè°ƒç”¨SleepServiceçš„åˆ¤æ–­æ–¹æ³•ï¼Œä¼ å…¥å½“å‰æ—¶é—´å’Œé…ç½®ï¼Œè·å–å½“å‰åº”è¯¥æ˜¾ç¤ºçš„ç¡çœ çŠ¶æ€ã€‚

SleepServiceæ¥æ”¶åˆ°çŠ¶æ€æŸ¥è¯¢è¯·æ±‚åï¼Œæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­é€»è¾‘ï¼šé¦–å…ˆæ£€æŸ¥åˆä¼‘æ—¶æ®µæ˜¯å¦å¯ç”¨ï¼Œå¦‚æœå¯ç”¨ä¸”å½“å‰æ—¶é—´åœ¨åˆä¼‘çª—å£å†…ï¼Œè¿”å›åˆä¼‘çŠ¶æ€ï¼›å¦åˆ™æ£€æŸ¥ä¸»ç¡çœ æ—¶æ®µï¼Œæ ¹æ®é…ç½®çš„èµ·æ­¢æ—¶é—´åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨ç¡çœ çª—å£å†…ï¼›æœ€åï¼Œå¦‚æœéƒ½ä¸åŒ¹é…ï¼Œæ£€æŸ¥è·ç¦»ç¡çœ å¼€å§‹æ˜¯å¦åœ¨æé†’é˜ˆå€¼å†…ï¼Œå¦‚æœæ˜¯è¿”å›å³å°†ç¡çœ çŠ¶æ€ï¼Œå¦åˆ™è¿”å›æ¸…é†’çŠ¶æ€ã€‚

çŠ¶æ€ç¡®å®šåï¼ŒTimeManagerå‘å¸ƒSTATE_CHANGEDäº‹ä»¶ï¼Œæºå¸¦æ–°çš„çŠ¶æ€ä¿¡æ¯ã€‚æ‰€æœ‰è®¢é˜…äº†è¯¥äº‹ä»¶çš„ç»„ä»¶ï¼ˆä¸»è¦æ˜¯UIç»„ä»¶ï¼‰ä¼šæ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–°è‡ªå·±çš„æ˜¾ç¤ºã€‚MainWindowæ”¶åˆ°äº‹ä»¶åï¼Œæ›´æ–°æ—¶é—´æ˜¾ç¤ºæ–‡æœ¬ã€çŠ¶æ€æ–‡å­—ã€èƒŒæ™¯é¢œè‰²å’Œå€’è®¡æ—¶ä¿¡æ¯ã€‚TrayIconæ”¶åˆ°äº‹ä»¶åï¼Œæ›´æ–°æ‰˜ç›˜å›¾æ ‡çš„æ ·å¼ã€‚NotificationServiceæ”¶åˆ°äº‹ä»¶åï¼Œæ ¹æ®é…ç½®å†³å®šæ˜¯å¦éœ€è¦å‘é€ç³»ç»Ÿé€šçŸ¥ã€‚

```
æ—¶é—´æ›´æ–°è¯¦ç»†åºåˆ—å›¾

    Scheduler         EventBus        TimeManager      SleepService       MainWindow
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚  (æ¯ç§’è§¦å‘)       â”‚                â”‚                â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚ TIME_TICK      â”‚                â”‚                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚                  â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚                â”‚ GetTime()      â”‚                  â”‚
       â”‚                  â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚                â”‚    CurrentTime â”‚                  â”‚
       â”‚                  â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚                â”‚ GetStatus()    â”‚                  â”‚
       â”‚                  â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚                â”‚    SleepStatus â”‚                  â”‚
       â”‚                  â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚  STATE_CHANGED â”‚                â”‚                  â”‚
       â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
       â”‚                  â”‚                â”‚                â”‚   UpdateDisplay()â”‚
       â”‚                  â”‚                â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                  â”‚                â”‚                â”‚                  â”‚
```

### 3.3 é…ç½®å˜æ›´å¤„ç†æµç¨‹

é…ç½®å˜æ›´å¯ä»¥ç”±ç”¨æˆ·é€šè¿‡ç•Œé¢æ“ä½œè§¦å‘ï¼Œä¹Ÿå¯ä»¥ç”±å¤–éƒ¨æ–‡ä»¶ä¿®æ”¹è§¦å‘ï¼ˆå¦‚æœå¯ç”¨äº†é…ç½®çƒ­æ›´æ–°ï¼‰ã€‚æ— è®ºå“ªç§è§¦å‘æ–¹å¼ï¼Œå¤„ç†æµç¨‹éƒ½æ˜¯ç›¸åŒçš„ã€‚

å½“ç”¨æˆ·é€šè¿‡SettingsPanelä¿®æ”¹è®¾ç½®æ—¶ï¼ŒSettingsPanelé¦–å…ˆåœ¨æœ¬åœ°éªŒè¯è¾“å…¥çš„æœ‰æ•ˆæ€§ï¼ˆå¦‚æ—¶é—´æ ¼å¼æ˜¯å¦æ­£ç¡®ã€æ•°å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…ï¼‰ã€‚éªŒè¯é€šè¿‡åï¼ŒSettingsPanelè°ƒç”¨ConfigServiceçš„æ›´æ–°æ–¹æ³•ã€‚ConfigServiceé¦–å…ˆæ›´æ–°å†…å­˜ä¸­çš„é…ç½®å‰¯æœ¬ï¼Œç„¶åå¼‚æ­¥ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨åŸå­å†™å…¥é¿å…æ•°æ®æŸåï¼‰ã€‚

é…ç½®ä¿å­˜æˆåŠŸåï¼ŒConfigServiceå‘å¸ƒCONFIG_CHANGEDäº‹ä»¶ï¼Œæºå¸¦å˜æ›´çš„é…ç½®é¡¹å’Œæ–°çš„å€¼ã€‚è®¢é˜…è¯¥äº‹ä»¶çš„ç»„ä»¶æ”¶åˆ°é€šçŸ¥åï¼Œè¿›è¡Œå¿…è¦çš„åˆ·æ–°æ“ä½œï¼šTimeManageræ£€æŸ¥æ˜¯å¦æœ‰ç¡çœ æ—¶é—´ç›¸å…³çš„é…ç½®å˜æ›´ï¼Œå¦‚æœæœ‰åˆ™é‡æ–°è®¡ç®—å½“å‰çŠ¶æ€ï¼›NotificationServiceæ£€æŸ¥æ˜¯å¦æœ‰é€šçŸ¥ç›¸å…³çš„é…ç½®å˜æ›´ï¼Œå¦‚æœæœ‰åˆ™æ›´æ–°é€šçŸ¥è®¾ç½®ï¼›MainWindowæ£€æŸ¥æ˜¯å¦æœ‰å¤–è§‚ç›¸å…³çš„é…ç½®å˜æ›´ï¼Œå¦‚æœæœ‰åˆ™æ›´æ–°ç•Œé¢æ ·å¼ã€‚

å¦‚æœé…ç½®ä¿å­˜å¤±è´¥ï¼ˆå¦‚ç£ç›˜å†™ä¿æŠ¤ï¼‰ï¼ŒConfigServiceä¼šå›æ»šå†…å­˜ä¸­çš„é…ç½®ï¼Œå¹¶å‘å¸ƒCONFIG_SAVE_FAILEDäº‹ä»¶ï¼Œæç¤ºç”¨æˆ·ä¿å­˜å¤±è´¥çš„åŸå› ã€‚

```
é…ç½®æ›´æ–°çŠ¶æ€å›¾

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æ“ä½œ   â”‚     â”‚  Settings   â”‚     â”‚  Config     â”‚     â”‚ ConfigFile  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚    Panel    â”‚     â”‚   Service   â”‚     â”‚  (ç£ç›˜)     â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚ modify_config()   â”‚                  â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                  â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚                   â”‚ validate()       â”‚                  â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚                   â”‚ update_config()  â”‚                  â”‚
       â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚                   â”‚                  â”‚ save_config()    â”‚
       â”‚                   â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚                   â”‚                  â”‚    success       â”‚
       â”‚                   â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚                   â”‚                  â”‚ publish()        â”‚
       â”‚                   â”‚                  â”‚â”€â”€â”               â”‚
       â”‚                   â”‚                  â”‚  â”‚               â”‚
       â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”˜               â”‚
       â”‚                   â”‚                  â”‚                  â”‚
       â”‚    result         â”‚                  â”‚                  â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
       â”‚                   â”‚                  â”‚                  â”‚
```

### 3.4 ç¡çœ çŠ¶æ€åˆ¤æ–­ç®—æ³•å®ç°

ç¡çœ çŠ¶æ€çš„åˆ¤æ–­æ˜¯åº”ç”¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦æ­£ç¡®å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µã€‚ç®—æ³•å®ç°é‡‡ç”¨æµæ°´çº¿å¼çš„åˆ¤æ–­æµç¨‹ï¼Œé€å±‚æ£€æŸ¥å„ç§å¯èƒ½æ€§ã€‚

```python
class SleepService:
    """ç¡çœ æœåŠ¡ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘"""
    
    def get_current_status(self, current_time: datetime, config: Config) -> SleepStatus:
        """
        è·å–å½“å‰ç¡çœ çŠ¶æ€çš„ä¸»å…¥å£æ–¹æ³•
        
        åˆ¤æ–­ä¼˜å…ˆçº§ï¼š
        1. åˆä¼‘æ—¶æ®µï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
        2. ä¸»ç¡çœ æ—¶æ®µ
        3. å³å°†ç¡çœ ï¼ˆæé†’é˜¶æ®µï¼‰
        4. ä¿æŒæ¸…é†’ï¼ˆé»˜è®¤çŠ¶æ€ï¼‰
        """
        # é¦–å…ˆæ£€æŸ¥åˆä¼‘æ—¶æ®µï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if config.nap_time.enabled:
            nap_status = self._check_nap_time(current_time, config.nap_time)
            if nap_status != SleepStatus.AWAKE:
                return nap_status
        
        # æ£€æŸ¥ä¸»ç¡çœ æ—¶æ®µ
        primary_status = self._check_primary_sleep_time(current_time, config.primary_sleep)
        if primary_status != SleepStatus.AWAKE:
            return primary_status
        
        # æ£€æŸ¥æ˜¯å¦å³å°†ç¡çœ 
        soon_status = self._check_soon_to_sleep(current_time, config.primary_sleep, config.reminder_minutes)
        if soon_status != SleepStatus.AWAKE:
            return soon_status
        
        return SleepStatus.AWAKE
    
    def _check_nap_time(self, current_time: datetime, nap_config: NapConfig) -> SleepStatus:
        """æ£€æŸ¥åˆä¼‘æ—¶æ®µ"""
        if self._is_time_in_window(current_time, nap_config.start, nap_config.end):
            return SleepStatus.NAP
        return SleepStatus.AWAKE
    
    def _check_primary_sleep_time(
        self, 
        current_time: datetime, 
        sleep_config: SleepConfig
    ) -> SleepStatus:
        """æ£€æŸ¥ä¸»ç¡çœ æ—¶æ®µ"""
        if self._is_time_in_window(current_time, sleep_config.start, sleep_config.end):
            return SleepStatus.SLEEPING
        return SleepStatus.AWAKE
    
    def _check_soon_to_sleep(
        self, 
        current_time: datetime, 
        sleep_config: SleepConfig,
        reminder_minutes: int
    ) -> SleepStatus:
        """æ£€æŸ¥æ˜¯å¦å³å°†ç¡çœ """
        minutes_to_sleep = self._minutes_until(current_time, sleep_config.start)
        if 0 < minutes_to_sleep <= reminder_minutes:
            return SleepStatus.SOON
        return SleepStatus.AWAKE
    
    def _is_time_in_window(self, current: time, start: time, end: time) -> bool:
        """
        åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦åœ¨æ—¶é—´çª—å£å†…
        
        å¤„ç†ä¸¤ç§æƒ…å†µï¼š
        - æ™®é€šçª—å£ï¼šstart <= endï¼ˆå¦‚åŒä¸€å¤©å†…çš„æ—¶é—´æ®µï¼‰
        - è·¨è¶Šåˆå¤œçª—å£ï¼šstart > endï¼ˆå¦‚ 23:00 - 07:00ï¼‰
        """
        if start <= end:
            # æ™®é€šæƒ…å†µï¼šåŒä¸€å¤©å†…çš„æ—¶é—´æ®µ
            return start <= current <= end
        else:
            # è·¨è¶Šåˆå¤œçš„æƒ…å†µ
            return current >= start or current <= end
    
    def _minutes_until(self, current: datetime, target: time) -> int:
        """
        è®¡ç®—è·ç¦»ç›®æ ‡æ—¶é—´çš„åˆ†é’Ÿæ•°
        æ­£ç¡®å¤„ç†è·¨è¶Šåˆå¤œçš„æƒ…å†µ
        """
        current_time = current.time()
        target_time = target
        
        # è®¡ç®—ä»Šå¤©çš„å‰©ä½™æ—¶é—´
        if current_time <= target_time:
            delta = datetime.combine(current.date(), target_time) - current
        else:
            # è·¨è¶Šåˆ°æ˜å¤©
            tomorrow = current.date() + timedelta(days=1)
            delta = datetime.combine(tomorrow, target_time) - current
        
        return int(delta.total_seconds() / 60)
```

### 3.5 é”™è¯¯å¤„ç†æ•°æ®æµ

é”™è¯¯å¤„ç†æ˜¯ä¿è¯åº”ç”¨ç¨³å®šæ€§çš„å…³é”®ã€‚ç³»ç»Ÿå®šä¹‰äº†å¤šç§é”™è¯¯ç±»å‹å’Œç›¸åº”çš„å¤„ç†ç­–ç•¥ï¼Œç¡®ä¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿèƒ½ç»™ç”¨æˆ·è‰¯å¥½çš„ä½“éªŒå¹¶ä¿ç•™è¶³å¤Ÿçš„è¯Šæ–­ä¿¡æ¯ã€‚

```
é”™è¯¯å¤„ç†æµç¨‹å›¾

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           é”™è¯¯å‘ç”Ÿç‚¹                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ–‡ä»¶è¯»å–    â”‚ â”‚ æ—¶é—´è®¡ç®—    â”‚ â”‚ UIæ¸²æŸ“      â”‚ â”‚ ç³»ç»Ÿè°ƒç”¨    â”‚      â”‚
â”‚  â”‚ é”™è¯¯        â”‚ â”‚ é”™è¯¯        â”‚ â”‚ é”™è¯¯        â”‚ â”‚ å¤±è´¥        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚               â”‚               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ErrorHandler          â”‚
                    â”‚    (ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                  â”‚
              â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ é…ç½®ç±»é”™è¯¯       â”‚ â”‚ è®¡ç®—ç±»é”™è¯¯       â”‚ â”‚ ç³»ç»Ÿç±»é”™è¯¯       â”‚
    â”‚ (ConfigError)   â”‚ â”‚ (CalcError)     â”‚ â”‚ (SystemError)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                   â”‚                   â”‚
             â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä½¿ç”¨é»˜è®¤é…ç½®     â”‚ â”‚ æ˜¾ç¤ºé”™è¯¯çŠ¶æ€     â”‚ â”‚ é™çº§åˆ°åŸºç¡€åŠŸèƒ½   â”‚
    â”‚ æç¤ºç”¨æˆ·æ£€æŸ¥    â”‚ â”‚ ç»§ç»­è¿è¡Œ        â”‚ â”‚ æç¤ºç”¨æˆ·é‡è¯•    â”‚
    â”‚ é…ç½®æ–‡ä»¶        â”‚ â”‚ è®°å½•é”™è¯¯æ—¥å¿—    â”‚ â”‚ è®°å½•é”™è¯¯æ—¥å¿—    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€é›†æˆç‚¹ä¸å¤–éƒ¨ä¾èµ–

### 4.1 ç³»ç»Ÿé›†æˆ

åº”ç”¨éœ€è¦ä¸åº•å±‚æ“ä½œç³»ç»Ÿè¿›è¡Œå¤šç§äº¤äº’ï¼Œä»¥ä¸‹æ˜¯å„å¹³å°çš„é›†æˆç‚¹å’Œå®ç°ç­–ç•¥ã€‚

**Windows é›†æˆ**æ–¹é¢ï¼Œç³»ç»Ÿé€šçŸ¥ä½¿ç”¨Win32 APIçš„Toasté€šçŸ¥åŠŸèƒ½ï¼Œé€šè¿‡python-win32åº“å®ç°æ‰˜ç›˜å›¾æ ‡å’Œæ°”æ³¡æç¤ºçš„åˆ›å»ºã€‚å¼€æœºè‡ªå¯åŠ¨é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨å®ç°ï¼ˆHKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Runï¼‰ã€‚ç³»ç»Ÿæ—¶é—´é€šè¿‡ctypesç›´æ¥è°ƒç”¨Windows APIè·å–ï¼Œä»¥ç¡®ä¿å‡†ç¡®æ€§é«˜äºPythonçš„timeæ¨¡å—ã€‚çª—å£ç‰¹æ•ˆæ”¯æŒä½¿ç”¨Windows Composition APIå®ç°äºšå…‹åŠ›/äº‘æ¯æ•ˆæœï¼ˆWindows 11ï¼‰ã€‚

**macOS é›†æˆ**æ–¹é¢ï¼Œç³»ç»Ÿé€šçŸ¥ä½¿ç”¨Foundationæ¡†æ¶çš„NSUserNotification APIï¼Œé€šè¿‡pyobjcåº“å®ç°ã€‚æ‰˜ç›˜å›¾æ ‡ä½¿ç”¨NSStatusItemï¼Œå®ç°ç‚¹å‡»èœå•å’Œå›¾æ ‡å¼¹å‡ºåŠŸèƒ½ã€‚å¼€æœºè‡ªå¯åŠ¨é€šè¿‡åˆ›å»º~/Library/LaunchAgents/.plistæ–‡ä»¶å®ç°ã€‚çª—å£ç‰¹æ•ˆä½¿ç”¨NSVisualEffectMaterialå®ç°æ¯›ç»ç’ƒæ•ˆæœï¼ˆmacOS 10.14+ï¼‰ã€‚åº”ç”¨è¿˜é›†æˆMacçš„å‹¿æ‰°æ¨¡å¼æ£€æµ‹ï¼Œé¿å…åœ¨å‹¿æ‰°æ¨¡å¼ä¸‹å‘é€é€šçŸ¥ã€‚

**Linux é›†æˆ**æ–¹é¢ï¼Œç³»ç»Ÿé€šçŸ¥ä½¿ç”¨libnotifyé€šè¿‡python-dbusåº“å®ç°ï¼Œæ”¯æŒGNOMEã€KDEã€XFCEç­‰ä¸»æµæ¡Œé¢ç¯å¢ƒã€‚æ‰˜ç›˜å›¾æ ‡ä½¿ç”¨X11çŠ¶æ€é€šçŸ¥åŒºåŸŸï¼ˆSystem Tray Protocolï¼‰ã€‚å¼€æœºè‡ªå¯åŠ¨æ”¯æŒXFCEã€KDEã€GNOMEç­‰å¤šç§æ¡Œé¢ç¯å¢ƒçš„è‡ªåŠ¨å¯åŠ¨åè®®ã€‚æ—¶é—´è·å–é€šè¿‡D-Busæ¥å£è·å–ç²¾ç¡®æ—¶é—´ï¼Œé¿å…æ—¶åŒºå¤„ç†é—®é¢˜ã€‚

### 4.2 å¤–éƒ¨ä¾èµ–ç®¡ç†

æœ¬é¡¹ç›®ä¸¥æ ¼æ§åˆ¶å¤–éƒ¨ä¾èµ–ï¼Œä»…åœ¨å¿…è¦æ—¶å¼•å…¥ï¼Œå¹¶ç¡®ä¿æ¯ä¸ªä¾èµ–éƒ½æ˜¯ç»è¿‡éªŒè¯çš„ç¨³å®šç‰ˆæœ¬ã€‚

```
# requirements.txt - é¡¹ç›®ä¾èµ–é…ç½®

# æ ¸å¿ƒä¾èµ– - æœ€å°åŒ–ä¾èµ–é›†
# ä»…ä½¿ç”¨Pythonå†…ç½®åº“ï¼Œæ— éœ€é¢å¤–å®‰è£…

# å¯é€‰å¢å¼ºä¾èµ– - æŒ‰éœ€å®‰è£…
PyQt5>=5.15.0; sys_platform == 'win' or sys_platform == 'darwin' or sys_platform == 'linux'
pywin32>=300; sys_platform == 'win'
pyobjc-core>=8.0; sys_platform == 'darwin'
pyobjc>=8.0; sys_platform == 'darwin'
dbus-python>=1.2.0; sys_platform == 'linux'

# å¼€å‘ä¾èµ–
pytest>=7.0.0
pytest-cov>=4.0.0
black>=22.0.0
mypy>=0.950
pylint>=2.16.0
```

### 4.3 é…ç½®æ–‡ä»¶æ ¼å¼ä¸ç‰ˆæœ¬ç®¡ç†

é…ç½®æ–‡ä»¶é‡‡ç”¨JSONæ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ç®¡ç†é…ç½®æ ¼å¼çš„å˜æ›´ã€‚

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "config_version": "1.0.0",
  "last_modified": "2024-01-15T10:30:00Z",
  
  "display": {
    "time_format": "24h",
    "date_format": "locale",
    "show_seconds": true,
    "show_weekday": true
  },
  
  "sleep_schedule": {
    "primary": {
      "enabled": true,
      "start": "23:00",
      "end": "07:00",
      "reminder_before_minutes": 30
    },
    "nap": {
      "enabled": true,
      "start": "12:30",
      "end": "13:30",
      "reminder_before_minutes": 15
    }
  },
  
  "notifications": {
    "sound_enabled": true,
    "system_notify_enabled": true,
    "notify_on_state_change": true,
    "quiet_hours": {
      "enabled": false,
      "start": "22:00",
      "end": "07:00"
    }
  },
  
  "appearance": {
    "theme": "auto",
    "opacity": 100,
    "compact_mode": false,
    "custom_colors": {
      "awake": "#2ECC71",
      "soon": "#F39C12",
      "sleeping": "#9B59B6",
      "nap": "#3498DB"
    }
  },
  
  "behavior": {
    "start_at_login": false,
    "minimize_to_tray": true,
    "close_to_tray": false,
    "check_for_updates": true
  }
}
```

### 4.4 æ’ä»¶æ‰©å±•æ¥å£

ä¸ºäº†æ”¯æŒæœªæ¥çš„åŠŸèƒ½æ‰©å±•ï¼Œç³»ç»Ÿå®šä¹‰äº†æ’ä»¶æ¥å£ï¼Œå…è®¸ç¬¬ä¸‰æ–¹å¼€å‘è€…æˆ–ç”¨æˆ·æ‰©å±•åŠŸèƒ½ã€‚

```python
# æ’ä»¶æ¥å£å®šä¹‰
from abc import ABC, abstractmethod
from typing import Optional
from dataclasses import dataclass

@dataclass
class PluginMetadata:
    """æ’ä»¶å…ƒä¿¡æ¯"""
    name: str
    version: str
    author: str
    description: str
    dependencies: list[str] = None

class SleepClockPlugin(ABC):
    """æ’ä»¶åŸºç±»"""
    
    @property
    @abstractmethod
    def metadata(self) -> PluginMetadata:
        """è¿”å›æ’ä»¶å…ƒä¿¡æ¯"""
        pass
    
    def initialize(self, app_context: 'AppContext') -> None:
        """æ’ä»¶åˆå§‹åŒ–"""
        pass
    
    def on_time_tick(self, current_time: datetime) -> None:
        """æ¯ç§’æ—¶é—´æ›´æ–°äº‹ä»¶"""
        pass
    
    def on_state_change(self, old_status: SleepStatus, new_status: SleepStatus) -> None:
        """çŠ¶æ€å˜æ›´äº‹ä»¶"""
        pass
    
    def on_shutdown(self) -> None:
        """åº”ç”¨å…³é—­äº‹ä»¶"""
        pass
    
    def get_settings_ui(self) -> Optional[QWidget]:
        """è¿”å›è®¾ç½®ç•Œé¢ç»„ä»¶"""
        return None

# ç¤ºä¾‹æ’ä»¶ï¼šç•ªèŒ„é’Ÿæ’ä»¶
class PomodoroPlugin(SleepClockPlugin):
    """ç•ªèŒ„é’ŸåŠŸèƒ½æ’ä»¶"""
    
    @property
    def metadata(self) -> PluginMetadata:
        return PluginMetadata(
            name="Pomodoro Timer",
            version="1.0.0",
            author="User",
            description="ç•ªèŒ„é’Ÿä¸“æ³¨è®¡æ—¶åŠŸèƒ½"
        )
    
    def on_state_change(self, old_status: SleepStatus, new_status: SleepStatus) -> None:
        # åœ¨ç¡çœ çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°ç•ªèŒ„é’ŸçŠ¶æ€
        if new_status == SleepStatus.SLEEPING:
            self._pause_timer()
        elif old_status == SleepStatus.SLEEPING and new_status == SleepStatus.AWAKE:
            self._resume_timer()
```

---

## äº”ã€æµ‹è¯•ç­–ç•¥ä¸è´¨é‡ä¿éšœ

### 5.1 æµ‹è¯•é‡‘å­—å¡”

æœ¬é¡¹ç›®é‡‡ç”¨æµ‹è¯•é‡‘å­—å¡”ä½œä¸ºæµ‹è¯•ç­–ç•¥æŒ‡å¯¼ï¼Œç¡®ä¿ä¸åŒå±‚æ¬¡çš„æµ‹è¯•è¦†ç›–è¾¾åˆ°åˆç†çš„æ¯”ä¾‹ã€‚

```
æµ‹è¯•é‡‘å­—å¡”

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  ç«¯åˆ°ç«¯æµ‹è¯•  â”‚  5% - éªŒè¯å®Œæ•´åŠŸèƒ½æµç¨‹
                         â•±â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•²
                        â•±                  â•²
                       â•±    é›†æˆæµ‹è¯•        â•²    25% - éªŒè¯ç»„ä»¶äº¤äº’
                      â•±â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•²
                     â•±                        â•²
                    â•±      å•å…ƒæµ‹è¯•            â•²    70% - éªŒè¯ç‹¬ç«‹åŠŸèƒ½
                   â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
```

**å•å…ƒæµ‹è¯•å±‚**æ˜¯æµ‹è¯•é‡‘å­—å¡”çš„åŸºç¡€ï¼Œå æ¯”çº¦70%ã€‚å•å…ƒæµ‹è¯•é’ˆå¯¹æ¯ä¸ªç‹¬ç«‹çš„å‡½æ•°ã€ç±»å’Œæ¨¡å—è¿›è¡Œæµ‹è¯•ï¼ŒéªŒè¯å…¶è¡Œä¸ºçš„æ­£ç¡®æ€§ã€‚å•å…ƒæµ‹è¯•åº”è¯¥å¿«é€Ÿæ‰§è¡Œï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œä¸ä¾èµ–å¤–éƒ¨èµ„æºï¼ˆä½¿ç”¨mockï¼‰ï¼Œå¹¶è¦†ç›–å„ç§æ­£å¸¸æƒ…å†µå’Œè¾¹ç•Œæƒ…å†µã€‚

**é›†æˆæµ‹è¯•å±‚**å æ¯”çº¦25%ï¼ŒéªŒè¯å¤šä¸ªç»„ä»¶ååŒå·¥ä½œçš„æ­£ç¡®æ€§ã€‚é›†æˆæµ‹è¯•å…³æ³¨ç»„ä»¶ä¹‹é—´çš„æ¥å£äº¤äº’ï¼Œå¦‚ConfigServiceä¸ConfigRepositoryçš„äº¤äº’ã€EventBusçš„äº‹ä»¶åˆ†å‘ã€TimeManagerä¸SleepServiceçš„çŠ¶æ€è®¡ç®—åä½œç­‰ã€‚é›†æˆæµ‹è¯•ä½¿ç”¨çœŸå®çš„ç»„ä»¶å®ä¾‹ï¼Œä½†æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ã€‚

**ç«¯åˆ°ç«¯æµ‹è¯•å±‚**å æ¯”çº¦5%ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯è¿›è¡Œå…¨åŠŸèƒ½æµ‹è¯•ã€‚ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯å®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹ï¼Œå¦‚å¯åŠ¨åº”ç”¨ã€ä¿®æ”¹è®¾ç½®ã€è§‚å¯ŸçŠ¶æ€å˜åŒ–ã€é€€å‡ºåº”ç”¨ç­‰ã€‚è¿™ç±»æµ‹è¯•ä½¿ç”¨è‡ªåŠ¨åŒ–UIæµ‹è¯•æ¡†æ¶ï¼ˆå¦‚PyQtçš„QTestï¼‰æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œã€‚

### 5.2 å•å…ƒæµ‹è¯•è®¾è®¡

```python
# tests/test_sleep_service.py - ç¡çœ æœåŠ¡å•å…ƒæµ‹è¯•

import pytest
from datetime import time, datetime, date
from unittest.mock import Mock, patch

from src.core.sleep_service import SleepService
from src.core.config import Config, SleepConfig, NapConfig
from src.core.enums import SleepStatus

class TestSleepService:
    """ç¡çœ æœåŠ¡å•å…ƒæµ‹è¯•ç±»"""
    
    @pytest.fixture
    def sleep_service(self):
        """æµ‹è¯•å¤¹ä»¶ï¼šåˆ›å»ºç¡çœ æœåŠ¡å®ä¾‹"""
        return SleepService()
    
    @pytest.fixture
    def default_config(self):
        """æµ‹è¯•å¤¹ä»¶ï¼šé»˜è®¤é…ç½®"""
        return Config(
            primary_sleep=SleepConfig(
                enabled=True,
                start=time(23, 0),
                end=time(7, 0),
                reminder_minutes=30
            ),
            nap_time=NapConfig(
                enabled=True,
                start=time(12, 30),
                end=time(13, 30),
                reminder_minutes=15
            )
        )
    
    def test_awake_during_day(self, sleep_service, default_config):
        """æµ‹è¯•ç™½å¤©æ¸…é†’çŠ¶æ€"""
        # 14:00 - ä¸‹åˆæ¸…é†’æ—¶æ®µ
        current = datetime(2024, 1, 15, 14, 0, 0)
        
        status = sleep_service.get_current_status(current, default_config)
        
        assert status == SleepStatus.AWAKE
    
    def test_sleeping_at_night(self, sleep_service, default_config):
        """æµ‹è¯•å¤œé—´ç¡çœ çŠ¶æ€"""
        # 02:00 - æ·±å¤œç¡çœ æ—¶æ®µ
        current = datetime(2024, 1, 15, 2, 0, 0)
        
        status = sleep_service.get_current_status(current, default_config)
        
        assert status == SleepStatus.SLEEPING
    
    def test_nap_time_priority(self, sleep_service, default_config):
        """æµ‹è¯•åˆä¼‘æ—¶æ®µä¼˜å…ˆäºä¸»ç¡çœ æ—¶æ®µ"""
        # 13:00 - åˆä¼‘æ—¶æ®µï¼ˆä¹Ÿåœ¨ä¸»ç¡çœ çª—å£å¤–ï¼‰
        current = datetime(2024, 1, 15, 13, 0, 0)
        
        status = sleep_service.get_current_status(current, default_config)
        
        assert status == SleepStatus.NAP
    
    def test_soon_to_sleep(self, sleep_service, default_config):
        """æµ‹è¯•å³å°†ç¡çœ çŠ¶æ€"""
        # 22:45 - è·ç¦»23:00è¿˜æœ‰15åˆ†é’Ÿ
        current = datetime(2024, 1, 15, 22, 45, 0)
        
        status = sleep_service.get_current_status(current, default_config)
        
        assert status == SleepStatus.SOON
    
    def test_cross_midnight_window(self, sleep_service, default_config):
        """æµ‹è¯•è·¨è¶Šåˆå¤œçš„æ—¶é—´çª—å£åˆ¤æ–­"""
        # 23:30 - ç¡çœ å¼€å§‹å
        current = datetime(2024, 1, 15, 23, 30, 0)
        status = sleep_service.get_current_status(current, default_config)
        assert status == SleepStatus.SLEEPING
        
        # 06:30 - ç¡çœ ç»“æŸå‰
        current = datetime(2024, 1, 16, 6, 30, 0)
        status = sleep_service.get_current_status(current, default_config)
        assert status == SleepStatus.SLEEPING
        
        # 08:00 - ç¡çœ ç»“æŸå
        current = datetime(2024, 1, 16, 8, 0, 0)
        status = sleep_service.get_current_status(current, default_config)
        assert status == SleepStatus.AWAKE
    
    def test_disabled_sleep_window(self, sleep_service):
        """æµ‹è¯•ç¦ç”¨çš„ç¡çœ çª—å£"""
        config = Config(
            primary_sleep=SleepConfig(
                enabled=False,  # ç¦ç”¨ä¸»ç¡çœ 
                start=time(23, 0),
                end=time(7, 0),
                reminder_minutes=30
            ),
            nap_time=NapConfig(
                enabled=False,
                start=time(12, 30),
                end=time(13, 30),
                reminder_minutes=15
            )
        )
        
        # 02:00 - è™½ç„¶æ˜¯ä¼ ç»Ÿç¡çœ æ—¶é—´ï¼Œä½†å·²ç¦ç”¨
        current = datetime(2024, 1, 15, 2, 0, 0)
        status = sleep_service.get_current_status(current, config)
        
        assert status == SleepStatus.AWAKE
    
    @pytest.mark.parametrize("current_time,expected_status", [
        #è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹
        (datetime(2024, 1, 15, 12, 29, 59), SleepStatus.AWAKE),  # åˆä¼‘å¼€å§‹å‰1ç§’
        (datetime(2024, 1, 15, 12, 30, 0), SleepStatus.NAP),     # åˆä¼‘å¼€å§‹æ—¶åˆ»
        (datetime(2024, 1, 15, 13, 29, 59), SleepStatus.NAP),    # åˆä¼‘ç»“æŸå‰1ç§’
        (datetime(2024, 1, 15, 13, 30, 0), SleepStatus.AWAKE),   # åˆä¼‘ç»“æŸæ—¶åˆ»
    ])
    def test_nap_boundary_cases(self, sleep_service, default_config, current_time, expected_status):
        """æµ‹è¯•åˆä¼‘æ—¶æ®µè¾¹ç•Œæƒ…å†µ"""
        status = sleep_service.get_current_status(current_time, default_config)
        assert status == expected_status
```

### 5.3 é›†æˆæµ‹è¯•è®¾è®¡

```python
# tests/test_integration.py - é›†æˆæµ‹è¯•

import pytest
import tempfile
import os
from unittest.mock import Mock, patch
import json

from src.core.config_manager import ConfigManager
from src.core.time_manager import TimeManager
from src.core.event_bus import EventBus
from src.core.sleep_service import SleepService

class TestConfigToSleepIntegration:
    """é…ç½®åˆ°ç¡çœ æœåŠ¡çš„é›†æˆæµ‹è¯•"""
    
    @pytest.fixture
    def event_bus(self):
        """äº‹ä»¶æ€»çº¿å¤¹ä»¶"""
        return EventBus()
    
    @pytest.fixture
    def temp_config_file(self):
        """ä¸´æ—¶é…ç½®æ–‡ä»¶å¤¹ä»¶"""
        with tempfile.NamedTemporaryFile(mode='w', suffix='.json', delete=False) as f:
            config = {
                "config_version": "1.0.0",
                "primary_sleep": {
                    "enabled": True,
                    "start": "22:30",
                    "end": "06:00",
                    "reminder_minutes": 20
                },
                "nap_time": {
                    "enabled": False,
                    "start": "13:00",
                    "end": "14:00",
                    "reminder_minutes": 10
                }
            }
            json.dump(config, f)
            f.flush()
            
            yield f.name
            
            # æ¸…ç†
            os.unlink(f.name)
    
    def test_config_change_triggers_status_recalculation(
        self, event_bus, temp_config_file
    ):
        """æµ‹è¯•é…ç½®å˜æ›´è§¦å‘çŠ¶æ€é‡æ–°è®¡ç®—"""
        # åˆ›åººç»„ä»¶
        config_manager = ConfigManager(temp_config_file, event_bus)
        sleep_service = SleepService(event_bus)
        time_manager = TimeManager(config_manager, sleep_service, event_bus)
        
        # æ¨¡æ‹ŸçŠ¶æ€å˜æ›´å›è°ƒ
        recalculate_count = 0
        def on_recalculate():
            nonlocal recalculate_count
            recalculate_count += 1
        
        # è®¢é˜…çŠ¶æ€é‡æ–°è®¡ç®—äº‹ä»¶
        event_bus.subscribe("CONFIG_CHANGED", on_recalculate)
        
        # åŠ è½½é…ç½®
        config_manager.load_config()
        
        # ä¿®æ”¹é…ç½®
        config = config_manager.get_config()
        config['primary_sleep']['start'] = "23:00"
        config_manager.save_config(config)
        
        # éªŒè¯çŠ¶æ€é‡æ–°è®¡ç®—è¢«è§¦å‘
        assert recalculate_count >= 1

class TestTimeTickToDisplayIntegration:
    """æ—¶é—´æ›´æ–°åˆ°æ˜¾ç¤ºçš„é›†æˆæµ‹è¯•"""
    
    @pytest.fixture
    def integrated_components(self):
        """é›†æˆæµ‹è¯•çš„ç»„ä»¶é›†åˆ"""
        event_bus = EventBus()
        config_manager = ConfigManager()
        sleep_service = SleepService()
        time_manager = TimeManager(config_manager, sleep_service, event_bus)
        
        return {
            'event_bus': event_bus,
            'config_manager': config_manager,
            'sleep_service': sleep_service,
            'time_manager': time_manager
        }
    
    def test_time_tick_triggers_display_update(self, integrated_components):
        """æµ‹è¯•æ—¶é—´æ›´æ–°è§¦å‘æ˜¾ç¤ºæ›´æ–°"""
        event_bus = integrated_components['event_bus']
        time_manager = integrated_components['time_manager']
        
        # è®°å½•æ˜¾ç¤ºæ›´æ–°è°ƒç”¨
        update_calls = []
        
        def capture_display_update(time_str, status):
            update_calls.append((time_str, status))
        
        event_bus.subscribe("TIME_TICK", capture_display_update)
        
        # è§¦å‘æ—¶é—´æ›´æ–°
        event_bus.publish("TIME_TICK", datetime.now())
        
        # éªŒè¯æ˜¾ç¤ºæ›´æ–°è¢«è°ƒç”¨
        assert len(update_calls) >= 1
```

### 5.4 ä»£ç è´¨é‡ä¿éšœæªæ–½

æœ¬é¡¹ç›®é‡‡ç”¨å¤šç§å·¥å…·å’Œå®è·µç¡®ä¿ä»£ç è´¨é‡ã€‚

**é™æ€ä»£ç åˆ†æ**æ–¹é¢ï¼Œé¡¹ç›®ä½¿ç”¨Blackè¿›è¡Œä»£ç æ ¼å¼åŒ–ï¼Œç¡®ä¿å›¢é˜Ÿä»£ç é£æ ¼ä¸€è‡´ï¼›ä½¿ç”¨Pylintè¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼Œå…³æ³¨ä»£ç å¼‚å‘³ã€æ½œåœ¨é”™è¯¯å’Œå¤æ‚åº¦è¿‡é«˜çš„é—®é¢˜ï¼›ä½¿ç”¨mypyè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿ç±»å‹æ³¨è§£çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚è¿™äº›å·¥å…·åœ¨æäº¤å‰è‡ªåŠ¨è¿è¡Œï¼Œä»»ä½•è¿åè§„èŒƒçš„ä»£ç éƒ½æ— æ³•æäº¤ã€‚

**æŒç»­é›†æˆ**æ–¹é¢ï¼Œé¡¹ç›®ä½¿ç”¨GitHub Actionsæˆ–ç±»ä¼¼çš„CIå¹³å°ï¼Œåœ¨æ¯æ¬¡ä»£ç æäº¤æ—¶è‡ªåŠ¨è¿è¡Œä»¥ä¸‹æ£€æŸ¥ï¼šå®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼›é™æ€ä»£ç åˆ†æï¼›ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼›ä»¥åŠæ„å»ºæµ‹è¯•ï¼ˆç¡®ä¿ä»£ç èƒ½å¤ŸæˆåŠŸæ‰“åŒ…ï¼‰ã€‚CIæµæ°´çº¿è¿˜ä¼šåœ¨æ¯æ¬¡å‘å¸ƒå‰è¿›è¡Œæ›´å…¨é¢çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬ç«¯åˆ°ç«¯æµ‹è¯•å’Œå¤šå¹³å°å…¼å®¹æ€§æµ‹è¯•ã€‚

**ä»£ç è¦†ç›–ç‡**è¦æ±‚ï¼šå•å…ƒæµ‹è¯•çš„ä»£ç è¦†ç›–ç‡ä¸ä½äº80%ï¼Œå…³é”®æ¨¡å—ï¼ˆå¦‚SleepServiceï¼‰çš„è¦†ç›–ç‡ä¸ä½äº95%ã€‚æ¯æ¬¡CIè¿è¡Œéƒ½ä¼šç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼Œå¹¶è·Ÿè¸ªè¦†ç›–ç‡çš„å˜åŒ–è¶‹åŠ¿ã€‚è¦†ç›–ç‡ä¸‹é™çš„æäº¤éœ€è¦é¢å¤–å®¡æŸ¥ã€‚

### 5.5 æµ‹è¯•æ•°æ®ç®¡ç†

æµ‹è¯•æ•°æ®ç®¡ç†éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

**æµ‹è¯•å¤¹ä»¶å¤ç”¨**ï¼šä½¿ç”¨pytestçš„fixtureæœºåˆ¶åˆ›å»ºå¯å¤ç”¨çš„æµ‹è¯•æ•°æ®ï¼Œå¦‚æ¨¡æ‹Ÿé…ç½®ã€æ¨¡æ‹Ÿæ—¶é—´ç­‰ã€‚è¿™äº›å¤¹ä»¶å®šä¹‰åœ¨conftest.pyä¸­ï¼Œä¾›æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä½¿ç”¨ã€‚

**Mockå¤–éƒ¨ä¾èµ–**ï¼šå¯¹äºæ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æ—¶é—´ç­‰å¤–éƒ¨ä¾èµ–ï¼Œä½¿ç”¨unittest.mockè¿›è¡Œæ¨¡æ‹Ÿï¼Œç¡®ä¿æµ‹è¯•çš„ç‹¬ç«‹æ€§å’Œå¿«é€Ÿæ‰§è¡Œã€‚

**è¾¹ç•Œå€¼æµ‹è¯•**ï¼šç‰¹åˆ«å…³æ³¨æ—¶é—´åˆ¤æ–­çš„è¾¹ç•Œæƒ…å†µï¼Œå¦‚æ—¶é—´çª—å£çš„èµ·æ­¢ç‚¹ã€è·¨è¶Šåˆå¤œçš„ç‰¹æ®Šæƒ…å†µç­‰ã€‚è¿™äº›è¾¹ç•Œæƒ…å†µå¾€å¾€æ˜¯bugçš„æ ¹æºï¼Œéœ€è¦ä¸“é—¨çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–ã€‚

**éšæœºåŒ–æµ‹è¯•**ï¼šå¼•å…¥pytest-randomizeæ’ä»¶ï¼Œéšæœºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„é¡ºåºï¼Œé¿å…æµ‹è¯•ä¹‹é—´çš„éšå¼ä¾èµ–å¯¼è‡´çš„é—®é¢˜ã€‚åŒæ—¶å¼•å…¥å±æ€§æµ‹è¯•ï¼ˆä½¿ç”¨hypothesisåº“ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆå¤§é‡è¾¹ç•Œè¾“å…¥è¿›è¡Œæµ‹è¯•ã€‚

---

## å…­ã€é¡¹ç›®å®æ–½æŒ‡å—

### 6.1 å¼€å‘ç¯å¢ƒæ­å»º

**Pythonç¯å¢ƒé…ç½®**è¦æ±‚ä½¿ç”¨Python 3.8æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨pyenvæˆ–condaç®¡ç†Pythonç‰ˆæœ¬ã€‚åˆ›å»ºè™šæ‹Ÿç¯å¢ƒåï¼Œä½¿ç”¨pip install -r requirements.txtå®‰è£…æ‰€æœ‰ä¾èµ–ã€‚å¼€å‘æ—¶å»ºè®®å®‰è£…å®Œæ•´çš„å¼€å‘ä¾èµ–ï¼ˆrequirements-dev.txtï¼‰ã€‚

**IDEé…ç½®**æ¨èä½¿ç”¨VS Codeæˆ–PyCharmã€‚VS Codeéœ€è¦å®‰è£…Pythonæ‰©å±•ã€Pylanceè¯­è¨€æœåŠ¡å™¨å’ŒBlack Formatteræ‰©å±•ã€‚PyCharméœ€è¦é…ç½®Pythonè§£é‡Šå™¨ã€å¯ç”¨pylinté›†æˆå’Œä»£ç æ ¼å¼åŒ–ã€‚ä¸¤ç§IDEéƒ½åº”é…ç½®ä¸ºä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„.coveragercå’Œ.pyproject.tomlé…ç½®æ–‡ä»¶ã€‚

**é¢„æäº¤é’©å­**ä½¿ç”¨pre-commitæ¡†æ¶ï¼Œåœ¨æ¯æ¬¡gitæäº¤å‰è‡ªåŠ¨è¿è¡Œä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼š

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        language_version: python3.11
        
  - repo: https://github.com/pycqa/pylint
    rev: v3.0.3
    hooks:
      - id: pylint
        args: [--disable=R,C,--max-line-length=100]
        
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-datetime]
```

### 6.2 ç¼–ç è§„èŒƒ

**å‘½åè§„èŒƒ**éµå¾ªPythonçš„PEP 8æŒ‡å—ï¼Œå¹¶æœ‰ä»¥ä¸‹è¡¥å……è§„åˆ™ï¼šç±»åä½¿ç”¨å¤§é©¼å³°å‘½åæ³•ï¼ˆPascalCaseï¼‰ï¼›å‡½æ•°å’Œæ–¹æ³•åä½¿ç”¨å°å†™ä¸‹åˆ’çº¿å‘½åæ³•ï¼ˆsnake_caseï¼‰ï¼›å¸¸é‡ä½¿ç”¨å…¨å¤§å†™ä¸‹åˆ’çº¿å‘½åæ³•ï¼ˆSCREAMING_SNAKE_CASEï¼‰ï¼›ç§æœ‰æˆå‘˜ä½¿ç”¨å•ä¸‹åˆ’çº¿å‰ç¼€ï¼ˆå¦‚_selfï¼‰ï¼›æŠ½è±¡ç±»ä½¿ç”¨Abstractå‰ç¼€ã€‚

**æ–‡æ¡£è§„èŒƒ**æ¯ä¸ªå…¬å¼€çš„æ¨¡å—ã€ç±»å’Œå‡½æ•°éƒ½éœ€è¦docstringã€‚å‡½æ•°docstringéµå¾ªGoogleé£æ ¼ï¼ŒåŒ…å«Argsã€Returnså’ŒRaisesç­‰sectionã€‚ç±»å‹æ³¨è§£åº”å°½å¯èƒ½è¯¦ç»†ï¼Œå¯¹äºå¤æ‚ç±»å‹æ·»åŠ æ³¨é‡Šè¯´æ˜ã€‚

```python
def calculate_sleep_duration(start_time: time, end_time: time) -> timedelta:
    """
    è®¡ç®—ç¡çœ æ—¶é•¿ï¼Œæ”¯æŒè·¨è¶Šåˆå¤œçš„æƒ…å†µ
    
    Args:
        start_time: ç¡çœ å¼€å§‹æ—¶é—´
        end_time: ç¡çœ ç»“æŸæ—¶é—´
        
    Returns:
        timedelta: ç¡çœ æ—¶é•¿
        
    Examples:
        >>> calculate_sleep_duration(time(23, 0), time(7, 0))
        timedelta(hours=8)
    """
    if start_time <= end_time:
        return timedelta(hours=end_time.hour - start_time.hour, 
                         minutes=end_time.minute - start_time.minute)
    else:
        # è·¨è¶Šåˆå¤œï¼šä»Šæ™šåˆ°æ˜æ—©
        return timedelta(hours=24 - start_time.hour + end_time.hour,
                         minutes=-start_time.minute + end_time.minute)
```

### 6.3 ç‰ˆæœ¬å‘å¸ƒæµç¨‹

ç‰ˆæœ¬å·é‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼ˆSemantic Versioningï¼‰ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ã€‚ä¸»ç‰ˆæœ¬å·å˜æ›´è¡¨ç¤ºä¸å…¼å®¹çš„APIå˜æ›´ï¼›æ¬¡ç‰ˆæœ¬å·å˜æ›´è¡¨ç¤ºæ–°åŠŸèƒ½çš„å‘åå…¼å®¹æ·»åŠ ï¼›ä¿®è®¢å·å˜æ›´è¡¨ç¤ºå‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤ã€‚

å‘å¸ƒå‰æ£€æŸ¥æ¸…å•åŒ…æ‹¬ï¼šæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼›ä»£ç è¦†ç›–ç‡è¾¾æ ‡ï¼›æ–‡æ¡£å·²æ›´æ–°ï¼›ç‰ˆæœ¬å·å·²æ›´æ–°ï¼›CHANGELOGå·²ç¼–å†™ï¼›ä»¥åŠåœ¨æ‰€æœ‰ç›®æ ‡å¹³å°ä¸Šæµ‹è¯•é€šè¿‡ã€‚

---

## ä¸ƒã€æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°äº†Pythonç¡çœ æ—¶é’Ÿåº”ç”¨çš„æŠ€æœ¯è®¾è®¡æ–¹æ¡ˆï¼Œæ¶µç›–äº†ç³»ç»Ÿæ¶æ„ã€ç»„ä»¶è®¾è®¡ã€æ•°æ®æµç¨‹ã€é›†æˆç­–ç•¥å’Œæµ‹è¯•æ–¹æ³•ç­‰å¤šä¸ªç»´åº¦ã€‚é€šè¿‡é‡‡ç”¨åˆ†å±‚æ¶æ„å’Œäº‹ä»¶é©±åŠ¨æ¶æ„çš„æ··åˆæ¨¡å¼ï¼Œç³»ç»Ÿå®ç°äº†æ¸…æ™°çš„èŒè´£åˆ’åˆ†å’Œçµæ´»çš„æ‰©å±•èƒ½åŠ›ã€‚è®¾è®¡æ¨¡å¼çš„åº”ç”¨è¿›ä¸€æ­¥æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

é¡¹ç›®å®æ–½åº”ä¸¥æ ¼æŒ‰ç…§æœ¬æ–‡æ¡£çš„è®¾è®¡è¿›è¡Œå¼€å‘ï¼Œéµå¾ªç¼–ç è§„èŒƒå’Œæµ‹è¯•ç­–ç•¥ï¼Œç¡®ä¿æœ€ç»ˆäº¤ä»˜çš„è½¯ä»¶è´¨é‡ç¬¦åˆé¢„æœŸã€‚åç»­çš„åŠŸèƒ½è¿­ä»£å’Œæ–°éœ€æ±‚ä¹Ÿåº”åŸºäºæœ¬æ–‡æ¡£çš„æ¶æ„è¿›è¡Œè¯„ä¼°å’Œå®ç°ï¼Œé¿å…æ¶æ„è…åŒ–ã€‚

### ç¬¬ä¸‰é˜¶æ®µï¼šä»£ç å®ç°
<think>
The user wants me to generate a single-file Python application for a "Sleep Reminder Clock". Let me review the requirements:

1. **Core Features**:
   - Display current system time
   - Automatically determine if it's time for bed/sleep
   - User-friendly interface

2. **Technical Requirements**:
   - Single file only: `main.py`
   - Self-contained (no local imports)
   - Must be executable
   - Must include welcome message and run a concrete scenario
   - Proper variable scoping
   - Syntax must be perfect ASCII

3. **Language**: The user's request was in Chinese, so I should respond in Chinese with the code.

Let me design the application:

**Features to implement**:
1. Real-time clock display (time and date)
2. Sleep time configuration (bedtime and wake time)
3. Status indicator showing if it's time to sleep or not
4. Command-line interface with clear output
5. Configurable sleep hours

**Structure**:
- Imports (datetime, time, etc.)
- Constants (sleep configuration)
- Functions (main logic)
- Main entry point with demo

Let me write clean, well-documented code:

```python
#!/usr/bin/env python3
"""
Sleep Reminder Clock - ç¡çœ æé†’æ—¶é’Ÿ

A lightweight application that displays current system time and
automatically determines whether it is time to sleep based on
user-configured sleep schedules.

Features:
- Real-time clock display
- Configurable sleep schedule
- Visual status indicators
- Automatic sleep recommendations

Author: Generated by AI
Version: 1.0.0
"""

import time
from datetime import datetime, timedelta
import sys

# Version and app info
APP_NAME = "Sleep Reminder Clock"
APP_VERSION = "1.0.0"

# Default sleep schedule configuration
DEFAULT_BEDTIME_HOUR = 22  # 10:00 PM

DEFAULT_WAKE_HOUR = 7      # 7:00 AM
DEFAULT_SLEEP_HOURS = 8    # Recommended sleep duration

I'll continue configuring the default sleep schedule settings. The app will use predefined bedtime, wake time, and recommended sleep duration to help users track their rest patterns. These default values ensure a consistent sleep schedule right from the start.

The configuration allows for flexible customization while providing sensible initial recommendations. Users can adjust these settings to match their personal sleep needs and preferences.

The application prepares to determine sleep status by checking the current time against the configured schedule. It will evaluate whether the current time falls within the recommended sleep window or is approaching the designated bedtime.

I calculate the bedtime and wake time as time objects, then compare the current hour against these thresholds. This helps determine if the person should be preparing for sleep or waking up. The logic handles different scenarios, such as early morning hours before the wake time, which might indicate the person should still be sleeping.

The function will return a status indicating whether it's time to sleep, time to wake up, or the remaining time until the next sleep or wake period. This helps users track their sleep schedule and receive timely notifications about their rest schedule.

I'll create a function to display a visual representation of the current time and sleep status. The display uses emoji and color-coded text to provide an intuitive and engaging interface. It shows the current time, date, and a sleep-related emoji with a descriptive message about the current sleep state.

The main application loop will run continuously, updating the display every second and providing real-time feedback about the user's sleep schedule. This ensures users can easily track their current time and receive visual cues about their sleep status.

I recognize that continuously clearing the console might disrupt the user experience on different platforms. Instead, I'll modify the approach to provide a clear, non-intrusive update mechanism that works consistently across various operating systems.

The key is to create a display that updates smoothly without causing visual flickering or unexpected console behavior. By carefully managing console output, I can ensure a clean and informative sleep reminder application.

I'll implement a lightweight, cross-platform solution that prints the time and sleep status with minimal system overhead. The approach focuses on simplicity and compatibility, using basic system commands to manage console clearing and time display.
</think>

```python
#!/usr/bin/env python3
"""
Sleep Reminder Clock - ç¡çœ æé†’æ—¶é’Ÿ

ä¸€ä¸ªè½»é‡çº§åº”ç”¨ç¨‹åº,ç”¨äºæ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´å¹¶æ ¹æ®ç”¨æˆ·é…ç½®çš„
ç¡çœ ä½œæ¯æ—¶é—´è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦åº”è¯¥ä¼‘æ¯.

åŠŸèƒ½ç‰¹æ€§:
- å®æ—¶æ—¶é’Ÿæ˜¾ç¤º
- å¯é…ç½®çš„ç¡çœ æ—¶é—´è¡¨
- è§†è§‰çŠ¶æ€æŒ‡ç¤ºå™¨
- è‡ªåŠ¨ç¡çœ å»ºè®®

ä½œè€…: AIåŠ©æ‰‹
ç‰ˆæœ¬: 1.0.0
"""

import sys
import time
from datetime import datetime, timedelta

# åº”ç”¨é…ç½®å¸¸é‡
APP_NAME = "Sleep Reminder Clock"
APP_VERSION = "1.0.0"

# é»˜è®¤ç¡çœ æ—¶é—´é…ç½® (24å°æ—¶åˆ¶)
DEFAULT_BEDTIME_HOUR = 22    # é»˜è®¤å°±å¯æ—¶é—´: 22:00 (æ™šä¸Š10ç‚¹)
DEFAULT_WAKE_HOUR = 7        # é»˜è®¤èµ·åºŠæ—¶é—´: 07:00 (æ—©ä¸Š7ç‚¹)

def get_current_time_info():
    """
    è·å–å½“å‰ç³»ç»Ÿæ—¶é—´çš„è¯¦ç»†ä¿¡æ¯.

    è¿”å›åŒ…å«å½“å‰æ—¥æœŸæ—¶é—´çš„å„ä¸ªç»„æˆéƒ¨åˆ†çš„å­—å…¸,
    æ–¹ä¾¿åç»­æ ¼å¼åŒ–æ˜¾ç¤ºå’Œç¡çœ åˆ¤æ–­é€»è¾‘ä½¿ç”¨.

    è¿”å›:
        dict: åŒ…å«å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ã€æ˜ŸæœŸå‡ ä¿¡æ¯çš„å­—å…¸
    """
    now = datetime.now()
    return {
        'year': now.year,
        'month': now.month,
        'day': now.day,
        'hour': now.hour,
        'minute': now.minute,
        'second': now.second,
        'weekday': now.weekday(),  # 0=Monday, 6=Sunday
        'timestamp': now
    }

def get_weekday_name(weekday_number):
    """
    å°†æ˜ŸæœŸå‡ çš„æ•°å­—è½¬æ¢ä¸ºä¸­æ–‡åç§°.

    å‚æ•°:
        weekday_number: 0-6ä¹‹é—´çš„æ•´æ•°,0ä»£è¡¨æ˜ŸæœŸä¸€

    è¿”å›:
        str: æ˜ŸæœŸå‡ çš„ä¸­æ–‡åç§°
    """
    weekday_names = ['æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­', 'æ˜ŸæœŸæ—¥']
    return weekday_names[weekday_number]

def format_time_12h(hour, minute):
    """
    å°†24å°æ—¶åˆ¶æ—¶é—´è½¬æ¢ä¸º12å°æ—¶åˆ¶æ ¼å¼.

    å‚æ•°:
        hour: 0-23ä¹‹é—´çš„å°æ—¶æ•°
        minute: 0-59ä¹‹é—´çš„åˆ†é’Ÿæ•°

    è¿”å›:
        str: 12å°æ—¶åˆ¶æ—¶é—´å­—ç¬¦ä¸²,æ ¼å¼å¦‚ "ä¸Šåˆ10:30" æˆ– "ä¸‹åˆ8:45"
    """
    if hour == 0:
        display_hour = 12
        period = "ä¸Šåˆ"
    elif hour < 12:
        display_hour = hour
        period = "ä¸Šåˆ"
    elif hour == 12:
        display_hour = 12
        period = "ä¸‹åˆ"
    else:
        display_hour = hour - 12
        period = "ä¸‹åˆ"

    return f"{period}{display_hour}:{minute:02d}"

def format_time_24h(hour, minute):
    """
    æ ¼å¼åŒ–24å°æ—¶åˆ¶æ—¶é—´ä¸ºæ ‡å‡†æ˜¾ç¤ºæ ¼å¼.

    å‚æ•°:
        hour: 0-23ä¹‹é—´çš„å°æ—¶æ•°
        minute: 0-59ä¹‹é—´çš„åˆ†é’Ÿæ•°

    è¿”å›:
        str: 24å°æ—¶åˆ¶æ—¶é—´å­—ç¬¦ä¸²,æ ¼å¼å¦‚ "14:30"
    """
    return f"{hour:02d}:{minute:02d}"

def determine_sleep_status(current_hour, bedtime_hour, wake_hour):
    """
    æ ¹æ®å½“å‰æ—¶é—´å’Œé…ç½®çš„ç¡çœ æ—¶é—´åˆ¤æ–­ç¡çœ çŠ¶æ€.

    è¯¥å‡½æ•°ä½¿ç”¨æ™ºèƒ½åˆ¤æ–­é€»è¾‘æ¥ç¡®å®šç”¨æˆ·å½“å‰æ˜¯å¦åº”è¯¥ç¡è§‰ã€
    æ˜¯å¦å·²ç»ç¡è¿‡å¤´ã€æˆ–è€…è¿˜å‰©å¤šå°‘æ—¶é—´éœ€è¦å‡†å¤‡ç¡è§‰.

    å‚æ•°:
        current_hour: å½“å‰å°æ—¶ (0-23)
        bedtime_hour: å°±å¯æ—¶é—´å°æ—¶ (0-23)
        wake_hour: èµ·åºŠæ—¶é—´å°æ—¶ (0-23)

    è¿”å›:
        tuple: (çŠ¶æ€ä»£ç , çŠ¶æ€æè¿°)
        çŠ¶æ€ä»£ç :
            0 = åº”è¯¥ç¡è§‰äº†
            1 = å¯ä»¥å‡†å¤‡ç¡è§‰äº†(å¿«åˆ°å°±å¯æ—¶é—´)
            2 = æ­£å¸¸æ¸…é†’çŠ¶æ€
            3 = ç¡è¿‡å¤´äº†(è¶…è¿‡èµ·åºŠæ—¶é—´)
    """
    if current_hour >= bedtime_hour or current_hour < wake_hour:
        return (0, "åº”è¯¥ç¡è§‰äº†")
    elif current_hour >= bedtime_hour - 2:
        return (1, "å¿«åˆ°å°±å¯æ—¶é—´äº†")
    elif current_hour >= wake_hour and current_hour < wake_hour + 2:
        return (3, "ç¡è¿‡å¤´äº†,è¯¥èµ·åºŠäº†ï¼")
    else:
        return (2, "ä¿æŒæ¸…é†’,å¥½å¥½åˆ©ç”¨æ—¶é—´")

def get_sleep_emoji(status_code):
    """
    æ ¹æ®ç¡çœ çŠ¶æ€ä»£ç è¿”å›å¯¹åº”çš„è¡¨æƒ…ç¬¦å·.

    å‚æ•°:
        status_code: 0-3ä¹‹é—´çš„çŠ¶æ€ä»£ç 

    è¿”å›:
        str: ä»£è¡¨å½“å‰çŠ¶æ€çš„è¡¨æƒ…ç¬¦å·
    """
    emojis = {
        0: "ğŸ˜´",  # åº”è¯¥ç¡è§‰
        1: "ğŸ›ï¸",  # å¿«åˆ°å°±å¯æ—¶é—´
        2: "â˜€ï¸",  # æ¸…é†’çŠ¶æ€
        3: "â°"   # ç¡è¿‡å¤´äº†
    }
    return emojis.get(status_code, "â“")

def calculate_hours_until(target_hour):
    """
    è®¡ç®—è·ç¦»ç›®æ ‡æ—¶é—´è¿˜æœ‰å¤šå°‘å°æ—¶.

    å‚æ•°:
        target_hour: ç›®æ ‡å°æ—¶ (0-23)

    è¿”å›:
        int: è·ç¦»ç›®æ ‡æ—¶é—´çš„å°æ—¶æ•°
    """
    current_hour = datetime.now().hour

    if current_hour <= target_hour:
        return target_hour - current_hour
    else:
        return 24 - current_hour + target_hour

def display_welcome():
    """
    æ˜¾ç¤ºç¨‹åºæ¬¢è¿ä¿¡æ¯å’Œå½“å‰é…ç½®.
    """
    print("=" * 50)
    print(f"  {APP_NAME} v{APP_VERSION}")
    print("=" * 50)
    print()
    print("ç¨‹åºåŠŸèƒ½:")
    print("  - å®æ—¶æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´")
    print("  - è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦åº”è¯¥ç¡è§‰")
    print("  - æä¾›ç¡çœ å»ºè®®")
    print()
    print(f"å½“å‰é…ç½®:")
    print(f"  - å°±å¯æ—¶é—´: {DEFAULT_BEDTIME_HOUR:02d}:00")
    print(f"  - èµ·åºŠæ—¶é—´: {DEFAULT_WAKE_HOUR:02d}:00")
    print()
    print("-" * 50)

def display_time_and_status():
    """
    ä¸»æ˜¾ç¤ºå‡½æ•°,å±•ç¤ºå½“å‰æ—¶é—´å’Œç¡çœ çŠ¶æ€.

    è¿™æ˜¯ç¨‹åºçš„æ ¸å¿ƒæ˜¾ç¤ºå‡½æ•°,æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ¸…ç©ºæ§åˆ¶å°
    å¹¶é‡æ–°æ˜¾ç¤ºæœ€æ–°çš„æ—¶é—´ä¿¡æ¯å’Œç¡çœ çŠ¶æ€.
    """
    time_info = get_current_time_info()

    current_hour = time_info['hour']
    current_minute = time_info['minute']
    current_second = time_info['second']

    status_code, status_text = determine_sleep_status(
        current_hour,
        DEFAULT_BEDTIME_HOUR,
        DEFAULT_WAKE_HOUR
    )

    time_24h = format_time_24h(current_hour, current_minute)
    time_12h = format_time_12h(current_hour, current_minute)
    weekday = get_weekday_name(time_info['weekday'])
    date_str = f"{time_info['year']}å¹´{time_info['month']}æœˆ{time_info['day']}æ—¥"

    emoji = get_sleep_emoji(status_code)

    print("\n" * 2)
    print("â”Œ" + "â”€" * 48 + "â”")
    print("â”‚" + " " * 48 + "â”‚")
    print(f"â”‚     å½“å‰æ—¶é—´                    {time_24h}     â”‚")
    print(f"â”‚     {date_str} {weekday}              â”‚")
    print("â”‚" + " " * 48 + "â”‚")
    print("â”œ" + "â”€" * 48 + "â”¤")
    print("â”‚" + " " * 48 + "â”‚")
    print(f"â”‚     {emoji}  ç¡çœ çŠ¶æ€: {status_text}       â”‚")
    print("â”‚" + " " * 48 + "â”‚")

    if status_code == 1:
        hours_left = calculate_hours_until(DEFAULT_BEDTIME_HOUR)
        print(f"â”‚     è¿˜æœ‰ {hours_left} å°æ—¶å°±å¯ä»¥ç¡è§‰äº†        â”‚")
    elif status_code == 2:
        hours_to_bed = calculate_hours_until(DEFAULT_BEDTIME_HOUR)
        hours_to_wake = calculate_hours_until(DEFAULT_WAKE_HOUR)
        print(f"â”‚     è·å°±å¯è¿˜æœ‰ {hours_to_bed} å°æ—¶,è·èµ·åºŠè¿˜æœ‰ {hours_to_wake} å°æ—¶    â”‚")
    elif status_code == 0:
        hours_to_wake = calculate_hours_until(DEFAULT_WAKE_HOUR)
        print(f"â”‚     è·ç¦»èµ·åºŠè¿˜æœ‰ {hours_to_wake} å°æ—¶,å¥½å¥½ä¼‘æ¯    â”‚")

    print("â”‚" + " " * 48 + "â”‚")
    print("â””" + "â”€" * 48 + "â”˜")
    print()
    print(f"12å°æ—¶åˆ¶: {time_12h}  |  24å°æ—¶åˆ¶: {time_24h}  |  ç§’: {current_second:02d}")
    print()

def run_demo():
    """
    è¿è¡Œæ¼”ç¤ºæ¨¡å¼,å±•ç¤ºç¨‹åºçš„å„ç§çŠ¶æ€.

    æ¼”ç¤ºæ¨¡å¼ä¼šä¾æ¬¡æ˜¾ç¤ºä¸åŒçš„ç¡çœ çŠ¶æ€,
    è®©ç”¨æˆ·äº†è§£ç¨‹åºåœ¨ä¸åŒæƒ…å†µä¸‹çš„æ˜¾ç¤ºæ•ˆæœ.
    """
    display_welcome()

    print("\næ¼”ç¤ºæ¨¡å¼ - å±•ç¤ºä¸åŒçŠ¶æ€ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ:\n")

    demo_hours = [
        (21, "æ¥è¿‘å°±å¯æ—¶é—´ (21:00)"),
        (22, "åº”è¯¥ç¡è§‰äº† (22:00)"),
        (2, "æ·±å¤œç†Ÿç¡ä¸­ (02:00)"),
        (7, "èµ·åºŠæ—¶é—´ (07:00)"),
        (12, "æ¸…é†’å·¥ä½œæ—¶é—´ (12:00)")
    ]

    for demo_hour, description in demo_hours:
        print(f"\n{description}:")
        print("-" * 40)

        time_info = get_current_time_info()
        original_hour = time_info['hour']

        status_code, status_text = determine_sleep_status(
            demo_hour,
            DEFAULT_BEDTIME_HOUR,
            DEFAULT_WAKE_HOUR
        )

        print(f"ç¡çœ çŠ¶æ€: {status_text} {get_sleep_emoji(status_code)}")
        print()

    print("\n" + "=" * 50)
    print("å®æ—¶æ—¶é’Ÿæ¨¡å¼å¯åŠ¨ä¸­...")
    print("(æŒ‰ Ctrl+C é€€å‡ºç¨‹åº)")
    print("=" * 50)

def run_live_clock():
    """
    è¿è¡Œå®æ—¶æ—¶é’Ÿæ¨¡å¼,æŒç»­æ›´æ–°æ˜¾ç¤º.

    åœ¨å¾ªç¯ä¸­æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´æ˜¾ç¤º,
    ä½¿ç”¨æ¸…å±å’Œé‡ç»˜çš„æ–¹å¼å®ç°åŠ¨æ€æ•ˆæœ.
    """
    try:
        while True:
            display_time_and_status()
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n\nç¨‹åºå·²é€€å‡º.ç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼\n")

def main():
    """
    ç¨‹åºä¸»å…¥å£å‡½æ•°.

    æ ¹æ®å‘½ä»¤è¡Œå‚æ•°å†³å®šè¿è¡Œæ¨¡å¼:
    - æ— å‚æ•°: è¿è¡Œå®æ—¶æ—¶é’Ÿæ¨¡å¼
    - --demo: è¿è¡Œæ¼”ç¤ºæ¨¡å¼

    é»˜è®¤æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯,ç„¶åå¯åŠ¨å®æ—¶æ—¶é’Ÿ.
    """
    display_welcome()

    if len(sys.argv) > 1 and sys.argv[1] == "--demo":
        run_demo()
    else:
        print("å®æ—¶æ—¶é’Ÿè¿è¡Œä¸­ (æŒ‰ Ctrl+C é€€å‡º):\n")
        run_live_clock()

if __name__ == "__main__":
    main()
```

---

## 3. ä½¿ç”¨è¯´æ˜

**åŸºæœ¬ç”¨æ³•**

```bash
# è¿è¡Œå®æ—¶æ—¶é’Ÿæ¨¡å¼(é»˜è®¤)
python main.py

# è¿è¡Œæ¼”ç¤ºæ¨¡å¼,æŸ¥çœ‹å„ç§çŠ¶æ€
python main.py --demo
```

**åŠŸèƒ½æ“ä½œ**

- ç¨‹åºå¯åŠ¨åè‡ªåŠ¨è¿›å…¥å®æ—¶æ—¶é’Ÿæ¨¡å¼
- æ¯ç§’è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºå½“å‰æ—¶é—´
- ç¡çœ çŠ¶æ€è‡ªåŠ¨æ ¹æ®é¢„è®¾æ—¶é—´è®¡ç®—
- ä½¿ç”¨ `Ctrl+C` ç»„åˆé”®å¯éšæ—¶é€€å‡ºç¨‹åº

---

## 4. ç¡çœ æ—¶é—´é…ç½®

é»˜è®¤é…ç½®å¦‚ä¸‹:

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| å°±å¯æ—¶é—´ | 22:00 | æ™šä¸Š10ç‚¹ |
| èµ·åºŠæ—¶é—´ | 07:00 | æ—©ä¸Š7ç‚¹ |
| æ¨èç¡çœ æ—¶é•¿ | 8å°æ—¶ | æ ¹æ®ç”Ÿç†å¥åº·å»ºè®®è®¾å®š |

å¦‚éœ€è‡ªå®šä¹‰ç¡çœ æ—¶é—´,å¯ä¿®æ”¹ä»£ç ä¸­çš„ `DEFAULT_BEDTIME_HOUR` å’Œ `DEFAULT_WAKE_HOUR` å¸¸é‡å€¼.


## é¡¹ç›®ä¿¡æ¯

- **é¡¹ç›®åç§°**: generated_project_20260101_142907
- **æ–‡ä»¶æ•°é‡**: 4
- **æ€»å¤§å°**: 6993 å­—èŠ‚
- **è¯­æ³•éªŒè¯**: é€šè¿‡

### ä¾èµ–é¡¹
- pygame

### é¡¹ç›®ç»“æ„
- ä¸»æ–‡ä»¶: `main.py`
- æ€»æ–‡ä»¶æ•°: 4

## å¼€å‘æµç¨‹

1. **éœ€æ±‚æ¾„æ¸…**: ç†è§£ç”¨æˆ·æ„å›¾å’Œæ ¸å¿ƒåŠŸèƒ½
2. **æŠ€æœ¯é€‰å‹**: é€‰æ‹©åˆé€‚çš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶
3. **æ¶æ„è®¾è®¡**: ç¡®å®šç³»ç»Ÿç»“æ„å’Œç»„ä»¶å…³ç³»
4. **ä»£ç å®ç°**: ç”Ÿæˆå¯è¿è¡Œçš„ç¨‹åºä»£ç 
5. **æµ‹è¯•éªŒè¯**: ç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½å®Œæ•´æ€§

## è´¨é‡ä¿è¯

- âœ… è¯­æ³•æ­£ç¡®æ€§éªŒè¯
- âœ… ä¾èµ–å…³ç³»æ£€æŸ¥
- âœ… æ–‡ä»¶ç»“æ„å®Œæ•´æ€§
- âœ… æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

---

*æ­¤è®¡åˆ’ç”± AI Code Flow ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ*
