# 需求规格说明

## 用户需求
帮我写一个计算BMI的计算器

## 技术规格
BMI计算器技术规范
=================

一、核心功能与特性
-----------------

1.1 基本功能
BMI计算器用于根据用户输入的身高和体重数据，计算身体质量指数（Body Mass Index），帮助用户评估体重是否处于健康范围。核心计算逻辑基于世界卫生组织（WHO）制定的BMI公式：BMI = 体重(kg) / 身高(m)²。应用程序需要支持公制单位（公斤/厘米或公斤/米）和英制单位（磅/英寸/英尺）的输入与转换，并能够根据计算结果给出相应的健康分类建议。

1.2 健康分类功能
系统应能够根据计算出的BMI值，自动判定用户的体重状态分类。标准分类包括：体重过轻（BMI < 18.5）、正常范围（18.5 ≤ BMI < 25）、超重（25 ≤ BMI < 30）和肥胖（BMI ≥ 30）。应用程序还应支持针对特定人群（如亚洲人群）的分类标准调整功能，允许用户选择不同的分类标准体系以获得更准确的健康评估结果。

1.3 历史记录管理
应用程序需要具备本地数据存储能力，能够保存用户的计算历史记录。每次计算应记录测量日期、身高、体重、BMI值和健康分类信息。系统应支持查看历史记录、删除单条记录、清空所有历史数据等管理功能，并能够以时间倒序方式展示最近的计算结果。

1.4 数据可视化
为帮助用户更好地理解体重变化趋势，系统应提供BMI趋势图表功能。图表需要展示用户历次计算的BMI值变化曲线，并标注各次测量的健康分类状态。用户应能够选择查看不同时间范围的历史数据（如近一周、近一月、近三月或全部历史）。

二、技术要求与约束
------------------

2.1 输入验证要求
所有用户输入必须经过严格的格式验证和范围检查。身高输入范围应限制在50cm至300cm之间，体重输入范围应限制在10kg至500kg之间。系统应自动过滤输入中的空白字符，允许用户使用千位分隔符，并能够识别不同的十进制分隔符（点号或逗号）。对于英制单位，系统应支持"英尺+英寸"的复合输入格式。

2.2 计算精度要求
BMI计算应采用浮点数运算，结果保留一位小数。内部计算精度应不低于IEEE 754双精度浮点数的标准，以确保大批量数据处理时的准确性。健康分类判定应使用标准阈值，不允许用户自定义修改分类边界值。

2.3 跨平台兼容性
应用程序应支持主流操作系统环境，包括Windows 10/11、macOS 10.15及以上版本、Linux主流发行版。界面布局应具备自适应能力，能够在不同屏幕分辨率下保持良好的可读性和操作便利性。应用程序应支持系统深色模式，能够根据操作系统设置自动切换界面主题。

2.4 响应式设计
用户界面应具备即时响应能力，所有计算操作应在用户完成输入后的200毫秒内完成并显示结果。历史记录加载时间不应超过500毫秒，图表渲染时间不应超过1秒。应用程序应支持最小化到系统托盘或保持后台运行，以便用户随时快速访问。

三、数据结构与算法需求
----------------------

3.1 核心数据结构
系统需要定义结构化的数据模型来存储用户信息和计算记录。BMI记录数据结构应包含唯一标识符（UUID或自增整数）、时间戳（精确到秒）、身高值（浮点数，单位厘米）、体重值（浮点数，单位公斤）、BMI计算结果值（浮点数）、使用的单位体系（枚举值）、选择的分类标准（枚举值）以及可选的用户备注（字符串）。用户偏好设置数据结构应包含默认单位体系、默认分类标准、语言设置和主题偏好等配置信息。

3.2 计算算法
BMI计算采用直接数学公式实现，算法流程为：首先将输入的身高单位转换为米（若输入单位为厘米则除以100，若为英寸则乘以0.0254），然后将体重单位转换为公斤（若输入单位为磅则乘以0.453592），最后执行体重除以身高的平方运算。对于英制单位下的复合输入（英尺+英寸），应先将英尺部分乘以30.48、英寸部分乘以2.54后相加得到总厘米值，再进行单位转换和BMI计算。

3.3 分类判定算法
健康分类判定采用多条件分支结构实现。系统首先检查用户是否选择了特定的分类标准（如WHO标准或亚洲标准），然后根据对应标准的阈值区间进行分类。分类结果应包括分类代码、分类名称和简要说明。对于处于边界值的情况（如BMI正好等于18.5、25或30），判定应遵循"左闭右开"原则，即等于阈值时归入较高类别。

3.4 数据持久化方案
本地数据存储采用轻量级嵌入式数据库SQLite实现，数据库文件存储于用户配置目录下的专用文件夹中。表结构设计应包含主键索引以优化查询性能，并建立时间戳索引以支持时间范围查询。历史数据导出功能应支持CSV格式，便于用户在其他电子表格软件中进行分析处理。

四、用户界面与交互模式
----------------------

4.1 主界面布局
应用程序主界面应采用清晰的三栏式布局设计。左侧面板用于输入身高和体重数据，提供单位切换控件和计算按钮；中央结果显示区域实时展示计算出的BMI数值和分类结果；右侧或底部面板展示历史记录列表和BMI趋势图表。用户应能够在单次计算后立即看到完整的评估结果，包括BMI数值、健康分类、体重状态描述和建议信息。

4.2 输入交互设计
输入字段应支持键盘快捷键操作，用户可通过Tab键在输入框之间切换，按Enter键触发计算。系统应提供便捷的输入辅助功能，包括增加/减少数值的微调控件（上下箭头按钮）、清空输入内容的快速操作以及快速切换单位的切换按钮。输入框应支持全选和复制操作，便于用户重复使用历史数据。

4.3 结果展示方式
BMI计算结果应以大字体突出显示，分类结果使用颜色编码直观区分（绿色表示正常、黄色表示超重、红色表示肥胖、蓝色表示体重过轻）。结果页面应包含BMI值含义的解释说明和健康建议，建议内容可根据用户的具体分类情况动态调整。系统应提供健康体重范围参考计算功能，告知用户为达到正常分类所需的体重目标区间。

4.4 帮助与引导
首次使用应用程序时，应提供交互式引导教程，帮助用户了解各项功能的位置和使用方法。界面中应包含上下文帮助信息，用户将鼠标悬停在特定元素上时显示功能说明。应用程序应提供常见问题解答和健康知识科普内容，增强用户的健康管理意识和能力。

五、错误处理与边界情况
----------------------

5.1 输入错误处理
当用户输入无效数据时，系统应提供明确的错误提示信息，指出具体的错误类型和修正建议。错误状态不应导致程序崩溃或异常退出，而应保持界面响应并阻止无效计算的执行。对于边界值输入（如身高为0或负数、体重超出合理范围），系统应显示警告信息并提供合理的默认值建议。

5.2 异常情况处理
应用程序应具备完善的异常捕获机制，能够处理包括内存不足、存储空间不足、数据库损坏等异常情况。当历史数据存储失败时，系统应提示用户并建议清理存储空间或重试操作，不应丢失已输入的当前计算数据。应用程序应支持在异常退出后自动恢复用户最近的操作状态。

5.3 边界情况处理
对于极端输入值（如身高接近下限50cm或上限300cm），系统应确保计算结果在浮点数精度范围内正确可读。对于非常年幼或年长用户的特殊计算需求，应用程序应提供附加说明，指出标准BMI分类可能不适用于儿童、青少年或孕妇等特殊人群。系统应支持无网络环境下的完整功能运行，不依赖在线服务进行核心计算。

5.4 数据完整性保护
历史数据删除操作应提供确认机制，防止用户误操作导致数据丢失。批量删除或清空操作应要求二次确认，并可选择性地支持撤销功能。数据库操作应使用事务机制，确保写入操作的原子性，避免因异常中断导致数据损坏。

六、性能考虑
------------

6.1 启动性能
应用程序冷启动时间应控制在2秒以内，热启动时间应控制在500毫秒以内。启动过程应显示启动进度或品牌标识，避免用户感知到无响应状态。核心功能模块应采用懒加载策略，非必要功能（如图表渲染）在首次使用时再进行初始化。

6.2 计算性能
单次BMI计算操作的时间复杂度为O(1)，应在毫秒级时间内完成。批量数据处理（如历史记录导出、趋势分析）应采用增量计算和缓存策略，避免重复计算。图表数据准备应在后台线程执行，确保界面渲染不阻塞用户操作。

6.3 内存管理
应用程序内存占用应控制在合理范围内，不随历史记录增长而无限制增加。历史数据应采用分页加载机制，当记录数量超过阈值时仅加载当前页面的数据进行展示。用户配置和偏好设置应
