# 实现计划

## 用户需求
创建一个简单的待办事项应用

## 详细计划
# 待办事项应用技术规划文档

## 一、总体架构设计

### 1.1 架构模式选择

本应用采用分层架构模式，将用户界面、业务逻辑和数据持久化三个核心关注点进行清晰分离。这种架构模式能够有效降低各层之间的耦合度，使得后续的功能扩展、维护和测试工作更加便捷。分层架构的另一个优势在于它能够支持技术栈的灵活替换，例如当未来需要从桌面端迁移到Web端时，只需重新实现表现层，业务逻辑层和数据访问层的核心代码可以保持不变。

具体而言，应用将划分为四个核心层次。最顶层是表现层，负责所有用户界面的渲染和交互处理；其下是应用层，处理业务规则的协调和用例执行；再下是领域层，存放核心业务实体和业务规则；最底层是基础设施层，提供数据持久化、外部服务调用等技术支持。各层次之间遵循单向依赖原则，上层依赖下层提供的接口，下层对上层一无所知，这种设计确保了系统的可测试性和可维护性。

### 1.2 设计模式应用

在具体实现中，本应用将综合运用多种设计模式以确保代码质量和架构健壮性。工厂模式将用于创建不同类型的任务对象，根据用户选择的优先级和分类动态实例化相应的任务实体。策略模式将应用于排序功能的实现，针对创建时间排序、截止日期排序、优先级排序等不同策略定义统一的排序接口，用户切换排序方式时只需更换策略对象即可。观察者模式将用于实现数据变化的实时通知机制，当底层数据发生变更时，自动刷新受影响的界面组件。

此外，单例模式将应用于数据库连接管理器和应用配置管理器，确保全局只有一个数据库连接实例，避免资源浪费和数据不一致问题。命令模式将用于实现撤销功能，每一个用户操作都被封装为命令对象并压入命令历史栈，支持向前和向后追溯操作记录。适配器模式将用于处理数据格式的转换，确保存储层的数据格式与应用层的数据结构能够平滑对接。

### 1.3 技术栈选型

桌面客户端采用Python语言开发，选择PyQt6作为图形用户界面框架。PyQt6是Qt框架的Python绑定，提供了丰富的原生风格控件和强大的跨平台能力，能够在Windows、macOS和Linux上呈现一致的用户体验。Qt框架经过二十余年的发展和完善，其稳定性和性能表现均属业界领先水平。此外，PyQt6支持触屏设备和深色主题，能够满足移动化使用场景和现代审美需求。

数据持久化采用SQLite作为本地数据库解决方案。SQLite是一个轻量级的嵌入式关系型数据库，无需独立的数据库服务器进程，数据以单一文件形式存储，非常适合桌面应用的数据管理场景。SQLite支持完整的SQL语法和事务处理，能够满足任务数据的复杂查询需求，同时具备良好的性能表现。Python标准库中的sqlite3模块提供了对SQLite的原生支持，无需额外安装驱动程序。

应用打包将使用PyInstaller工具，它能够将Python脚本及其依赖打包为独立的可执行文件，简化分发和安装流程。对于跨平台部署需求，将针对各目标平台分别构建对应的安装包，Windows平台使用NSIS制作安装程序，macOS平台生成DMG磁盘映像，Linux平台则提供DEB和RPM两种包格式。

---

## 二、核心组件与职责

### 2.1 表现层组件

表现层是用户与应用交互的直接界面，负责所有视觉元素的呈现和用户输入的接收。主窗口组件作为应用的入口点，承担着整体界面布局和生命周期管理的职责，包括窗口的创建、大小调整、关闭处理，以及应用退出时的数据保存确认对话框。主窗口将采用MVC模式中的控制器角色，协调任务列表视图和分类侧边栏的同步更新。

任务列表视图组件负责以可视化方式展示待办事项集合，支持多种展示模式包括列表视图和卡片视图。该组件需要处理虚拟滚动以应对大量数据的渲染性能问题，仅在可视区域内创建和更新列表项元素。列表项组件则负责单个任务的外观呈现，包括标题文字、描述摘要、优先级指示器、截止日期标签和完成状态复选框等子元素的布局和样式设置。

任务编辑对话框组件负责新建任务和编辑已有任务的表单界面，包含标题输入框、描述多行文本编辑器、优先级下拉选择器、分类单选组和截止日期选择器等表单元素。该组件需要实现输入验证逻辑，在用户提交前检查标题是否为空、截止日期是否合法等约束条件。分类管理对话框组件负责分类的增删改操作，提供颜色选择器和图标选择功能。

搜索和筛选栏组件提供全局搜索框和筛选条件面板，搜索框支持实时搜索即用户输入时即时更新搜索结果，筛选面板则提供优先级多选框、分类单选钮和完成状态切换等条件组合。工具栏组件提供常用操作的快捷入口，包括新建任务按钮、批量完成按钮、批量删除按钮和导出按钮等。

### 2.2 应用层组件

任务用例控制器是应用层的核心组件，负责协调任务相关业务操作的执行流程。当用户执行创建、读取、更新或删除任务操作时，用例控制器首先进行参数验证和权限检查，然后调用领域层的服务完成业务逻辑处理，最后通知表现层刷新界面显示。用例控制器还负责事务管理，确保批量操作的原子性，即所有子操作要么全部成功，要么全部回滚以保持数据一致性。

分类用例控制器负责分类相关业务操作的管理，包括分类的创建、查询、更新和删除，以及分类与任务的关联关系维护。当用户删除一个分类时，用例控制器需要决定如何处理该分类下的任务，是跟随删除、转移到默认分类还是阻止删除操作，这些策略需要根据产品需求确定并统一执行。

搜索服务组件封装搜索相关的业务逻辑，提供基于关键词的模糊搜索能力，支持在任务标题和描述字段中进行匹配。搜索算法采用BM25算法进行相关性评分，能够根据关键词出现频率和位置计算每个任务的相关度得分，返回按相关度排序的搜索结果。搜索服务还负责高亮显示搜索结果中的关键词片段，帮助用户快速定位匹配位置。

筛选服务组件负责根据用户指定的筛选条件从任务集合中筛选出符合条件的子集。筛选条件支持逻辑组合，包括与、或、非三种关系，例如用户可以筛选出"高优先级且未完成"或"已过期或已取消"的任务集合。筛选结果以只读视图的形式返回，供表现层渲染使用。

### 2.3 领域层组件

任务实体是领域层的核心数据对象，封装任务的所有属性和业务规则。任务实体包含唯一标识符、标题、描述、创建时间、修改时间、截止日期、优先级、分类标识和完成状态等属性。每个属性都有对应的取值和赋值方法，在赋值时执行相应的业务规则验证，例如设置截止日期时需要确保日期值有效，设置优先级时需要确保值在允许的枚举范围内。任务实体还提供完成、反完成、延期等业务方法，封装状态变更的规则逻辑。

分类实体封装分类数据的领域模型，包含分类标识、名称、颜色值、图标标识和创建时间等属性。分类实体负责验证名称的唯一性，确保同一应用中不存在两个同名的分类。分类实体还维护与任务实体的关联关系，提供获取该分类下所有任务的任务查询方法。

优先级枚举定义任务优先级的可选值，包括紧急、高、中、低四个等级。每个优先级值关联一个数值权重，用于排序计算时的大小比较。枚举类还提供获取优先级显示名称和获取优先级对应颜色值的方法，支持表现层根据优先级渲染不同样式的视觉元素。

完成状态枚举定义任务完成状态的可选值，包括未完成、已完成、已取消三种状态。该枚举提供状态转换的合法性验证，例如只有未完成的任务才能标记为已完成，已完成的任务不能再次标记为已完成，这些状态机规则在枚举中实现。

### 2.4 基础设施层组件

数据库访问对象是连接应用与SQLite数据库的桥梁，提供任务数据和分类数据的增删改查操作。数据库访问对象屏蔽底层SQL语句的细节，向上层提供面向对象的持久化接口。创建操作将新实体写入数据库并返回生成的主键标识符，读取操作根据主键或查询条件从数据库加载实体数据，更新操作将修改后的实体同步到数据库，删除操作根据主键从数据库移除实体记录。数据库访问对象还负责管理数据库连接的生命
